<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Final Exam Request</title>
    <style>
        /* Force a white page background ONLY on pages that include our forms */
        html:has(#cs-exam),
        body:has(#cs-exam),
        html:has(#cs-req),
        body:has(#cs-req) {
            background-color: #fff !important;
        }

        /* If an Elementor section around the form has a background, neutralize it */
        .elementor-section:has(#cs-exam),
        .elementor-section:has(#cs-req) {
            background-color: #fff !important;
        }

        /* (styles unchanged) */
        #cs-exam,
        #cs-exam * {
            box-sizing: border-box;
        }

        #cs-exam {
            --cs-bg: #fff;
            --cs-ink: #0b1324;
            --cs-sub: #475569;
            --cs-line: #e5e7eb;
            --cs-primary: #001161;
            --cs-primary-ink: #fff;
            --cs-chip-bg: #eef2ff;
            --cs-chip-ink: #1e1b4b;
            max-width: 1200px;
            color: var(--cs-ink);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }

        #cs-exam .cs-card {
            background: var(--cs-bg);
            border: 1px solid var(--cs-line);
            border-radius: 16px;
            padding: 22px;
            box-shadow: 0 10px 28px rgba(2, 6, 23, .08);
        }

        #cs-exam .cs-chip {
            display: inline-block;
            background: var(--cs-chip-bg);
            color: var(--cs-chip-ink);
            border: 1px solid #e0e7ff;
            border-radius: 999px;
            padding: 6px 12px;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 10px;
        }

        #cs-exam .cs-row {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 16px;
        }

        @media (max-width:820px) {
            #cs-exam .cs-row {
                grid-template-columns: 1fr;
            }
        }

        #cs-exam .cs-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 6px;
        }

        #cs-exam .cs-label {
            font-size: 18px;
            font-weight: 700;
            color: var(--cs-ink);
        }

        #cs-exam .cs-req::after {
            content: " *";
            color: #e11d48;
        }

        #cs-exam .cs-input,
        #cs-exam select.cs-input,
        #cs-exam textarea.cs-input,
        #cs-exam input[type=file].cs-input {
            width: 100%;
            min-height: 52px;
            padding: 12px 14px;
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            background: #fff;
            color: var(--cs-ink);
            font-size: 18px;
            line-height: 1.3;
            outline: none;
            appearance: none;
            transition: border-color .15s, box-shadow .15s;
        }

        #cs-exam .cs-input::placeholder {
            color: #94a3b8;
        }

        #cs-exam .cs-input:focus {
            border-color: #4169e1;
            box-shadow: 0 0 0 3px color-mix(in srgb, #4169e1 25%, transparent);
        }

        #cs-exam select.cs-input {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="%23001161" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 18px 18px;
            padding-right: 48px;
            cursor: pointer;
        }

        #cs-exam select.cs-input:disabled {
            background: #f8fafc;
            color: #94a3b8;
            cursor: not-allowed;
            background-image: none;
        }

        #cs-exam textarea.cs-input {
            min-height: 120px;
            resize: vertical;
        }

        #cs-exam input[type=file].cs-input {
            min-height: auto;
            padding: 10px;
        }

        #cs-exam .cs-sep {
            border: none;
            border-top: 1px dashed #e2e8f0;
            margin: 16px 0;
        }

        #cs-exam .cs-terms {
            margin: 8px 0 4px 18px;
            padding: 0;
        }

        #cs-exam .cs-terms li {
            font-weight: 500;
            margin: 8px 0;
            font-size: 18px;
            color: #0b1324;
        }

        #cs-exam .cs-checks {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #cs-exam .cs-check {
            font-size: 18px;
            color: #0f172a;
            line-height: 1.45;
        }

        #cs-exam .cs-check input {
            margin-right: 10px;
        }

        #cs-exam .cs-actions {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        #cs-exam .cs-btn {
            background: var(--cs-primary);
            color: var(--cs-primary-ink);
            border: none;
            border-radius: 12px;
            padding: 12px 48px;
            font-weight: 800;
            cursor: pointer;
            font-size: 18px;
        }

        #cs-exam .cs-btn:hover {
            filter: brightness(1.05);
        }

        #cs-exam .cs-status {
            min-height: 1.4em;
            font-size: 18px;
        }

        #cs-exam .cs-ok {
            color: #16a34a;
            font-weight: 700;
        }

        #cs-exam .cs-err {
            color: #b91c1c;
            font-weight: 700;
        }

        /* Kill Elementor field shadows ONLY inside our forms, keep our focus ring */
        #cs-exam input.cs-input,
        #cs-exam select.cs-input,
        #cs-exam textarea.cs-input,
        #cs-exam input[type="file"].cs-input,
        #cs-req input.cs-input,
        #cs-req select.cs-input,
        #cs-req textarea.cs-input,
        #cs-req input[type="file"].cs-input {
            box-shadow: none;
        }

        /* Preserve our intended focus state */
        #cs-exam input.cs-input:focus,
        #cs-exam select.cs-input:focus,
        #cs-exam textarea.cs-input:focus,
        #cs-exam input[type="file"].cs-input:focus,
        #cs-req input.cs-input:focus,
        #cs-req select.cs-input:focus,
        #cs-req textarea.cs-input:focus,
        #cs-req input[type="file"].cs-input:focus {
            box-shadow: 0 0 0 3px color-mix(in srgb, #4169e1 25%, transparent);
        }
    </style>
</head>

<body>
    <div class="cs-wrap" id="cs-exam" role="form" aria-labelledby="exam-title">
        <section class="cs-card">
            <span class="cs-chip" id="exam-title">Final Exam — Request Form</span>

            <!-- Row: name/email/phone/date/mode -->
            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label cs-req" for="fname">First Name</label>
                    <input class="cs-input" id="fname" name="firstName" autocomplete="given-name" placeholder="First"
                        required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-req" for="lname">Last Name</label>
                    <input class="cs-input" id="lname" name="lastName" autocomplete="family-name" placeholder="Last"
                        required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-req" for="email">Email</label>
                    <input class="cs-input" id="email" name="email" type="email" placeholder="name@example.com"
                        required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-req" for="phone">Phone Number</label>
                    <input class="cs-input" id="phone" name="phone" placeholder="+1 555 555 5555" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-req" for="date">Preferred Exam Date</label>
                    <input class="cs-input" id="date" name="preferredDate" type="date" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-req" for="mode">Select Mode</label>
                    <select class="cs-input" id="mode" name="mode" required>
                        <option value="">Select mode…</option>
                        <option>Online</option>
                        <option>In-Person</option>
                    </select>
                </div>
            </div>

            <hr class="cs-sep" />

            <!-- Row: grade/course -->
            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label cs-req" for="grade">Select Grade</label>
                    <select class="cs-input" id="grade" name="grade" required></select>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-req" for="course">Course (code – name)</label>
                    <select class="cs-input" id="course" name="courseCode" required disabled>
                        <option value="">Select grade first…</option>
                    </select>
                </div>
            </div>

            <hr class="cs-sep" />

            <!-- Row: school/gc email -->
            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label" for="school">School name</label>
                    <input class="cs-input" id="school" name="schoolName" autocomplete="organization"
                        placeholder="e.g., Maple High School">
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-req" for="gcEmail">Guidance counsellor’s official school email</label>
                    <input class="cs-input" id="gcEmail" name="guidanceEmail" type="email"
                        placeholder="firstname.lastname@schoolboard.ca" required>
                </div>
            </div>

            <hr class="cs-sep" />

            <!-- Row:signature/transcript -->
            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label cs-req" for="stusig">Student Signature</label>
                    <input class="cs-input" id="stusig" name="studentSig" placeholder="Type full name as signature"
                        required>
                </div>
                <div class="cs-field">
                    <label class="cs-label" for="transcript">Upload Document (Transcript)</label>
                    <input class="cs-input" id="transcript" name="transcript" type="file"
                        accept=".pdf,.jpg,.jpeg,.png,.heic,.heif">
                </div>
            </div>

            <hr class="cs-sep" />

            <!-- Terms -->
            <span class="cs-chip">Terms &amp; Conditions</span>
            <ul class="cs-terms">
                <li>I completed all coursework for the selected course.</li>
                <li>All payments are complete and I understand my exam will be scheduled after payment is verified.</li>
                <li>I have provided my guidance counsellor’s official school email and I authorize the school to send my
                    final report card and official transcript to that address.</li>
                <li>I have completed the required prerequisite(s) for this course and will provide proof (report
                    card/transcript) if requested before scheduling.</li>
                <li>I will follow the exam rules and academic integrity policy; I understand identity verification may
                    be required.</li>
                <li>If you are applying for <strong>university</strong> this year, see
                    <a href="https://canstemeducation.com/student-services/ouac/" target="_blank" rel="noopener">OUAC –
                        Steps &amp; Important Dates</a>.
                </li>
                <li>If you are applying for <strong>college</strong> this year, see
                    <a href="https://canstemeducation.com/student-services/ocas/" target="_blank" rel="noopener">OCAS –
                        Steps &amp; Key Dates</a>.
                </li>
            </ul>
            <div class="cs-checks">
                <label class="cs-check">
                    <input id="ack" type="checkbox" required>
                    <strong>I agree to the terms above.</strong>
                </label>
            </div>

            <hr class="cs-sep" />

            <!-- Actions -->
            <div class="cs-actions">
                <button class="cs-btn" id="submitBtn" type="button">Submit</button>
                <span class="cs-status" id="status" aria-live="polite"></span>
            </div>
        </section>
    </div>

    <script>
        (function () {
            const WEB_APP_URL = '/wp-admin/admin-ajax.php?action=canstem_form_email';

            /* ===== Course datasets ===== */
            const D9 = [
                { code: "AVI1O", name: "Visual Arts" }, { code: "ADA1O", name: "Drama" },
                { code: "BEM1O", name: "Building The Entrepreneurial Mindset" },
                { code: "CGC1W", name: "Issues in Canadian Geography (De-Streamed)" },
                { code: "ENL1W", name: "English (De-Streamed)" },
                { code: "EAE1W", name: "English (French OSSD), De-Streamed" },
                { code: "ENG1L", name: "English (LDCC)" }, { code: "FSF1D", name: "French (De-Streamed)" },
                { code: "FSF1O", name: "Core French (Open)" },
                { code: "GLS1O", name: "Learning Strategies 1: Skills for Success" },
                { code: "GLE1O", name: "Learning Strategies 1: Skills for Success" },
                { code: "HFN1O", name: "Food and Nutrition" }, { code: "HIF1O", name: "Exploring Family Studies" },
                { code: "PPL1O", name: "Healthy Active Living Education" },
                { code: "MTH1W", name: "Mathematics (De-Streamed)" }, { code: "MAT1L", name: "Mathematics (LDCC)" },
                { code: "SNC1W", name: "Science (De-Streamed)" }, { code: "SNC1L", name: "Science (LDCC)" },
                { code: "TIJ1O", name: "Exploring Technologies" },
                { code: "TAS1O", name: "Technology and the Skilled Trades" },
                { code: "NONE", name: "Not in the list" }
            ];

            const D10 = [
                { code: "AVI2O", name: "Visual Arts (G10)" }, { code: "ADA2O", name: "Drama (G10)" },
                { code: "ASM2O", name: "Media Arts (G10)" },
                { code: "BEP2O", name: "Launching and Leading a Business (G10)" },
                { code: "CHC2D", name: "Canadian History Since WWI (Academic)" },
                { code: "CHC2P", name: "Canadian History Since WWI (Applied)" },
                { code: "CHV2O", name: "Civics and Citizenship" }, { code: "ENG2D", name: "English (Academic)" },
                { code: "ENG2P", name: "English (Applied)" }, { code: "ENG2L", name: "English (LDCC)" },
                { code: "EAE2D", name: "English (French OSSD, Academic)" },
                { code: "FSF2D", name: "French (Academic)" }, { code: "FSF2O", name: "Core French (Open)" },
                { code: "FSF2P", name: "Core French (Applied)" }, { code: "GLC2O", name: "Career Studies" },
                { code: "HIF2O", name: "Individual and Family Living" },
                { code: "HFN2O", name: "Food and Nutrition (G10)" },
                { code: "ICS2O", name: "Introduction to Computer Studies" },
                { code: "ICD2O", name: "Digital Technology & Innovations" },
                { code: "MPM2D", name: "Principles of Mathematics (Academic)" },
                { code: "MFM2P", name: "Foundations of Mathematics (Applied)" },
                { code: "MAT2L", name: "Mathematics (LDCC)" },
                { code: "PPL2O", name: "Healthy Active Living Education (G10)" },
                { code: "SNC2D", name: "Science (Academic)" }, { code: "SNC2P", name: "Science (Applied)" },
                { code: "SNC2L", name: "Science (LDCC)" }, { code: "RGJ2O", name: "Communications Technology (G10)" },
                { code: "TEJ2O", name: "Computer Technology (G10)" },
                { code: "TFJ2O", name: "Hospitality and Tourism (G10)" },
                { code: "TDJ2O", name: "Technological Design (G10)" },
                { code: "TAS2O", name: "Technology and the Skilled Trades (G10)" },
                { code: "NONE", name: "Not in the list" }
            ];

            const D11 = [
                { code: "AVI3M", name: "Visual Arts (U/C)" }, { code: "AVI3O", name: "Visual Arts (Open)" },
                { code: "ADA3M", name: "Drama (U/C)" }, { code: "ADA3O", name: "Drama (Open)" },
                { code: "ASM3M", name: "Media Arts (U/C)" }, { code: "ASM3O", name: "Media Arts (Open)" },
                { code: "BAF3M", name: "Financial Accounting Fundamentals" },
                { code: "BAI3E", name: "Accounting Essentials (Workplace)" },
                { code: "BDI3C", name: "Entrepreneurship: The Venture" },
                { code: "BDP3O", name: "Entrepreneurship: The Enterprising Person" },
                { code: "BTA3O", name: "ICT: The Digital Environment" },
                { code: "BMI3C", name: "Marketing: Goods, Services, Events" },
                { code: "CIE3M", name: "The Individual and the Economy" },
                { code: "CGD3M", name: "Regional Geography" },
                { code: "CGF3M", name: "Forces of Nature" },
                { code: "CGT3O", name: "Intro to Spatial Technologies (Open)" },
                { code: "CGG3O", name: "Travel & Tourism" },
                { code: "CHA3U", name: "American History" },
                { code: "CHW3U", name: "World History to 15th Century" },
                { code: "CHT3O", name: "World History since 1900 (Open)" },
                { code: "CLU3M", name: "Understanding Canadian Law" },
                { code: "CPC3O", name: "Politics in Action: Making Change" },
                { code: "ENG3C", name: "English (College)" },
                { code: "ENG3U", name: "English (University)" },
                { code: "ENG3E", name: "English (Workplace)" },
                { code: "EAE3U", name: "English (French OSSD, University)" },
                { code: "EPS3O", name: "Presentation and Speaking Skills" },
                { code: "EMS3O", name: "Media Studies (Open)" },
                { code: "FSF3U", name: "Core French (University)" },
                { code: "FSF3O", name: "Core French (Open)" },
                { code: "FEF3U", name: "Extended French (University)" },
                { code: "FIF3U", name: "French Immersion (University)" },
                { code: "FIF3O", name: "French Immersion (Open)" },
                { code: "GWL3O", name: "Designing Your Future" },
                { code: "HSG3M", name: "Gender Studies" },
                { code: "HSE3E", name: "Equity & Social Justice (Workplace)" },
                { code: "HFC3M", name: "Food and Culture" },
                { code: "HPW3C", name: "Working with Infants & Young Children" },
                { code: "HZB3M", name: "Philosophy: The Big Questions" },
                { code: "HRT3M", name: "World Religions" },
                { code: "HPC3O", name: "Raising Healthy Children" },
                { code: "HSP3U", name: "Intro to Anthropology (University)" },
                { code: "HSP3C", name: "Anthro/Psych/Soc (College)" },
                { code: "ICS3C", name: "Intro to Computer Programming (College)" },
                { code: "ICS3U", name: "Intro to Computer Science (University)" },
                { code: "IDC3O", name: "Sports & Entertainment Marketing (Open)" },
                { code: "MBF3C", name: "Foundations for College Mathematics" },
                { code: "MCF3M", name: "Functions and Applications" },
                { code: "MCR3U", name: "Functions" },
                { code: "MEL3E", name: "Math for Work & Everyday Life (Workplace)" },
                { code: "PPL3O", name: "Healthy Active Living Education" },
                { code: "PPZ3C", name: "Health for Life" },
                { code: "SBI3C", name: "Biology (College)" },
                { code: "SBI3U", name: "Biology (University)" },
                { code: "SCH3U", name: "Chemistry (University)" },
                { code: "SPH3U", name: "Physics (University)" },
                { code: "SVN3M", name: "Environmental Science (U/C)" },
                { code: "SVN3E", name: "Environmental Science (Workplace)" },
                { code: "TEI3M", name: "Computer Eng. Tech: Interfacing (U/C)" },
                { code: "TEJ3M", name: "Computer Engineering Technology (U/C)" },
                { code: "TEL3M", name: "Computer Eng. Tech: Electronics (U/C)" },
                { code: "TEN3M", name: "Computer Eng. Tech: Networking (U/C)" },
                { code: "TET3E", name: "Computer Technology: IT Support" },
                { code: "TEW3E", name: "Computer Technology: Network Support" },
                { code: "TGJ3M", name: "Communications Technology (U/C)" },
                { code: "TFE3E", name: "Hospitality & Tourism: Event Planning (W)" },
                { code: "TFJ3E", name: "Hospitality & Tourism (Workplace)" },
                { code: "TFJC", name: "Hospitality & Tourism (College)" },
                { code: "TDJ3M", name: "Technological Design (U/C)" },
                { code: "TGJ3O", name: "Communications Tech: Broadcast/Print" },
                { code: "TDJ3O", name: "Technological Design and the Environment" },
                { code: "TGI3M", name: "Interactive New Media & Animation (U/C)" },
                { code: "TGP3M", name: "Photography & Digital Imaging (U/C)" },
                { code: "TPD3M", name: "Health Care: Dental Services (U/C)" },
                { code: "TPL3M", name: "Health Care: Laboratory Services (U/C)" },
                { code: "TPM3M", name: "Health Care: Nursing/Medical Services (U/C)" },
                { code: "TPJ3C", name: "Health Care (College)" },
                { code: "TPJ3M", name: "Health Care (U/C)" },
                { code: "NONE", name: "Not in the list" }
            ];

            const D12 = [
                { code: "ADA4E", name: "Drama (Workplace)" }, { code: "ADA4M", name: "Drama (U/C)" },
                { code: "AEA4O", name: "Exploring & Creating in the Arts" },
                { code: "ASM4M", name: "Media Arts (U/C)" }, { code: "ASM4E", name: "Media Arts (Workplace)" },
                { code: "AVI4M", name: "Visual Arts (U/C)" }, { code: "BAT4M", name: "Financial Accounting Principles" },
                { code: "BDV4C", name: "Entrepreneurship: Venture Planning (C)" },
                { code: "BTX4C", name: "ICT: Multimedia Solutions (C)" },
                { code: "BBB4M", name: "International Business Fundamentals" },
                { code: "BOH4M", name: "Business Leadership" },
                { code: "CIA4U", name: "Analysing Current Economic Issues" },
                { code: "CGW4U", name: "World Issues (University)" },
                { code: "CGW4C", name: "World Issues (College)" },
                { code: "CGR4M", name: "Environment & Resource Management" },
                { code: "CGO4M", name: "Spatial Technologies in Action" },
                { code: "CGU4M", name: "World Geography: Urban Patterns" },
                { code: "CHY4U", name: "World History since 15th Century (U)" },
                { code: "CHY4C", name: "World History since 15th Century (C)" },
                { code: "CHI4U", name: "Canada: History, Identity & Culture" },
                { code: "CLN4U", name: "Canadian & International Law (U)" },
                { code: "CLN4C", name: "Legal Studies (College)" },
                { code: "CPW4U", name: "Canadian & International Politics" },
                { code: "ENG4U", name: "English (University)" },
                { code: "ENG4C", name: "English (College)" },
                { code: "ENG4E", name: "English (Workplace)" },
                { code: "EAE4U", name: "English (French OSSD, University)" },
                { code: "EWC4U", name: "The Writer’s Craft (University)" },
                { code: "EWC4C", name: "The Writer’s Craft (College)" },
                { code: "FSF4U", name: "Core French (University)" },
                { code: "FSF4O", name: "Core French (Open)" },
                { code: "HSE4M", name: "Equity & Social Justice" },
                { code: "HSC4M", name: "World Cultures" },
                { code: "HFA4U", name: "Nutrition & Health (University)" },
                { code: "HFA4C", name: "Nutrition & Health (College)" },
                { code: "HHS4U", name: "Families in Canada (University)" },
                { code: "HHS4C", name: "Families in Canada (College)" },
                { code: "HHG4M", name: "Human Development Through the Life Span" },
                { code: "HIP4O", name: "Personal Life Management" },
                { code: "HPD4C", name: "Working with School-Age Children & Adolescents" },
                { code: "HSB4U", name: "Challenge & Change in Society" },
                { code: "HZT4U", name: "Philosophy: Questions & Theories" },
                { code: "ICS4U", name: "Computer Science (University)" },
                { code: "ICS4C", name: "Computer Programming (College)" },
                { code: "IDC4U", name: "Sports & Entertainment Marketing (U)" },
                { code: "IDC4O", name: "Sports & Entertainment Marketing (Open)" },
                { code: "MHF4U", name: "Advanced Functions" },
                { code: "MCV4U", name: "Calculus and Vectors" },
                { code: "MDM4U", name: "Mathematics of Data Management" },
                { code: "MCT4C", name: "Mathematics for College Technology" },
                { code: "MAP4C", name: "Foundations for College Mathematics" },
                { code: "MEL4E", name: "Math for Work & Everyday Life (Workplace)" },
                { code: "OLC4O", name: "Ontario Secondary School Literacy Course" },
                { code: "PPL4O", name: "Healthy Active Living Education" },
                { code: "PLF4M", name: "Recreation & Healthy Active Living Leadership" },
                { code: "PSK4U", name: "Introductory Kinesiology" },
                { code: "SBI4U", name: "Biology (University)" },
                { code: "SCH4C", name: "Chemistry (College)" },
                { code: "SCH4U", name: "Chemistry (University)" },
                { code: "SPH4U", name: "Physics (University)" },
                { code: "SES4U", name: "Earth and Space Science" },
                { code: "SNC4M", name: "Science (U/C)" },
                { code: "SNC4E", name: "Science (Workplace)" },
                { code: "TGJ4M", name: "Communications Technology (U/C)" },
                { code: "TGJ4O", name: "Communications Tech: Digital Imagery & Web" },
                { code: "TEJ4M", name: "Computer Engineering Technology (U/C)" },
                { code: "TFJ4E", name: "Hospitality & Tourism (Workplace)" },
                { code: "TFJ4C", name: "Hospitality & Tourism (College)" },
                { code: "TDJ4M", name: "Technological Design (U/C)" },
                { code: "TDJ4O", name: "Technological Design in the 21st Century" },
                { code: "TEI4M", name: "Computer Eng. Tech: Interfacing (U/C)" },
                { code: "TEN4M", name: "Computer Eng. Tech: Networking" },
                { code: "TET4E", name: "Computer Technology: IT Support" },
                { code: "TEW4E", name: "Computer Technology: Network Support" },
                { code: "TGI4M", name: "Interactive New Media & Animation" },
                { code: "TGP4M", name: "Photography & Digital Imaging" },
                { code: "TOC4C", name: "Child Development" },
                { code: "TOG4C", name: "Gerontology" },
                { code: "TPD4M", name: "Health Care: Dental Services" },
                { code: "TPL4M", name: "Health Care: Laboratory Services" },
                { code: "TPM4M", name: "Health Care: Nursing/Medical Services" },
                { code: "TPP4M", name: "Health Services: Pharmacy" },
                { code: "TPT4M", name: "Health Care: Therapy Services" },
                { code: "TPJ4C", name: "Health Care (College)" },
                { code: "TPJ4E", name: "Health Care (Workplace)" },
                { code: "TPJ4M", name: "Health Care (U/C)" },
                { code: "NONE", name: "Not in the list" }
            ];

            const DESL = [
                { code: "NONE", name: "Not in the list" }, { code: "ESLAO", name: "ESL Level 1" },
                { code: "ESLBO", name: "ESL Level 2" }, { code: "ESLCO", name: "ESL Level 3" },
                { code: "ESLDO", name: "ESL Level 4" }, { code: "ESLEO", name: "ESL Level 5" },
                { code: "ELDAO", name: "ELD Level 1" }, { code: "ELDBO", name: "ELD Level 2" },
                { code: "ELDCO", name: "ELD Level 3" }, { code: "ELDDO", name: "ELD Level 4" },
                { code: "ELDEO", name: "ELD Level 5" }
            ];

            const GRADES = ["Select grade…", "Grade 9", "Grade 10", "Grade 11", "Grade 12", "ESL/ELD Courses"];
            const listFor = g => ({ "Grade 9": D9, "Grade 10": D10, "Grade 11": D11, "Grade 12": D12, "ESL/ELD Courses": DESL }[g] || []);

            const gSel = document.getElementById('grade');
            GRADES.forEach(g => gSel.appendChild(new Option(g, g)));
            gSel.value = GRADES[0];

            const cSel = document.getElementById('course');
            gSel.addEventListener('change', () => {
                cSel.innerHTML = '';
                const grade = gSel.value;
                if (!grade || grade === GRADES[0]) {
                    cSel.disabled = true;
                    cSel.appendChild(new Option('Select grade first…', ''));
                    return;
                }
                cSel.disabled = false;
                cSel.appendChild(new Option('Select course…', ''));
                listFor(grade).forEach(({ code, name }) => cSel.appendChild(new Option(`${code} – ${name}`, code)));
            });

            const val = id => (document.getElementById(id)?.value || '').trim();

            function setStatus(msg, ok) {
                const el = document.getElementById('status');
                el.className = 'cs-status';
                el.textContent = msg;
                if (ok === true) el.classList.add('cs-ok');
                else if (ok === false) el.classList.add('cs-err');
            }

            function isValid() {
                const req = ['fname', 'lname', 'email', 'phone', 'date', 'grade', 'course', 'mode', 'stusig', 'gcEmail', 'ack'];
                for (const k of req) {
                    const el = document.getElementById(k);
                    if (!el) continue;
                    if (el.type === 'checkbox') { if (!el.checked) { el.focus(); return false; } }
                    else if (!el.value) { el.focus(); return false; }
                }
                if (gSel.value === GRADES[0]) { gSel.focus(); return false; }
                if (!cSel.value) { cSel.focus(); return false; }
                return true;
            }

            function fileToBase64(file) {
                return new Promise((res, rej) => {
                    const r = new FileReader();
                    r.onload = () => {
                        const out = r.result || '';
                        const b64 = (out.split('base64,')[1] || '').trim();
                        res({ name: file.name, mimeType: file.type || 'application/octet-stream', dataBase64: b64 });
                    };
                    r.onerror = () => rej(r.error);
                    r.readAsDataURL(file);
                });
            }

            async function collectTranscript() {
                const input = document.getElementById('transcript');
                if (input && input.files && input.files.length) {
                    const f = input.files[0];
                    return [await fileToBase64(f)];
                }
                return [];
            }

            async function submitForm() {
                if (!isValid()) { setStatus('Please fill all required fields.', false); return; }
                setStatus('Submitting…');

                const attachments = await collectTranscript();
                const ack = document.getElementById('ack').checked;
                const fullName = `${val('fname')} ${val('lname')}`.trim();

                const payload = {
                    type: 'Final Exam',
                    name: fullName,              // backward compatibility
                    firstName: val('fname'),
                    lastName: val('lname'),
                    email: val('email'),
                    phone: val('phone'),
                    grade: val('grade'),
                    courseCode: val('course'),
                    preferredDate: val('date'),
                    mode: val('mode'),
                    studentSig: val('stusig'),
                    schoolName: val('school'),
                    guidanceEmail: val('gcEmail'),
                    acceptTerms: ack,
                    confirmations: {
                        acceptTerms: ack,
                        termsListAck: ack
                    },
                    attachments,
                    hasTranscript: attachments.length > 0
                };

                try {
                    const resp = await fetch(WEB_APP_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload),
                        credentials: 'same-origin'
                    });
                    const data = await resp.json().catch(() => ({ ok: false, error: 'Invalid server response' }));
                    if (resp.ok && data.ok) {
                        document.querySelectorAll('#cs-exam .cs-card input, #cs-exam .cs-card textarea, #cs-exam .cs-card select')
                            .forEach(x => { if (x.type === 'checkbox') x.checked = false; else x.value = ''; });
                        gSel.value = GRADES[0];
                        cSel.innerHTML = '';
                        cSel.disabled = true;
                        cSel.appendChild(new Option('Select grade first…', ''));
                        setStatus('Success! Your request has been emailed to the front desk.', true);
                    } else {
                        setStatus(data.error || 'Error sending your request. Please try again.', false);
                    }
                } catch {
                    setStatus('Network error. Please try again.', false);
                }
            }

            document.getElementById('submitBtn').addEventListener('click', e => {
                e.preventDefault();
                submitForm();
            });
        })();
    </script>
</body>

</html>