<!DOCTYPE html>
<html lang="en">

<head>
    <base target="_top">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CanSTEM Education â€“ Change Requests</title>

    <style>
        :root {
            --brand: #001161;
            --primary: #4169e1;
            --accent: #fbb025;
            --ink: #0f172a;
            --muted: #475569;
            --border: #e5e7eb;
            --bg: #fff;
            --soft: #f8fafc;
            --shadow: 0 10px 28px rgba(2, 6, 23, .08);
            --radius: 16px;
            --gap: clamp(12px, 2vw, 16px);
            --pad: clamp(16px, 3vw, 24px);
            --fs-xxs: clamp(10px, 1.4vw, 12px);
            --fs-xs: clamp(11px, 1.6vw, 13px);
            --fs-sm: clamp(12px, 1.8vw, 14px);
            --fs-md: clamp(14px, 2vw, 16px);
            --fs-lg: clamp(18px, 2.6vw, 22px);
            --fs-xl: clamp(20px, 3vw, 26px)
        }

        * {
            box-sizing: border-box
        }

        body {
            font-family: "Pen Sans", "DM Sans", Inter, system-ui, "Segoe UI", Roboto, Arial, sans-serif;
            margin: 0;
            background: var(--bg);
            color: var(--ink)
        }

        .wrap {
            max-width: 980px;
            margin: 0 auto;
            padding: clamp(16px, 3vw, 28px)
        }

        .header {
            background: #fff;
            border: 1px solid rgba(2, 6, 23, .08);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: var(--pad);
            margin-bottom: var(--gap)
        }

        .head-row {
            display: grid;
            grid-template-columns: auto 1fr;
            align-items: center;
            column-gap: 14px
        }

        .logo {
            height: 80px;
            max-width: 200px;
            width: auto;
            object-fit: contain
        }

        .header h1 {
            margin: 0;
            font-size: var(--fs-xl);
            color: var(--brand);
            font-weight: 700
        }

        .header p {
            margin: 6px 0 0;
            font-size: var(--fs-sm);
            color: var(--muted)
        }

        @media (max-width:600px) {
            .logo {
                height: 56px
            }

            .header h1 {
                font-size: clamp(16px, 4.6vw, 22px);
                line-height: 1.4
            }
        }

        .notice {
            margin: 12px 0 18px;
            padding: 12px 14px;
            line-height: 28px;
            border: 1px dashed var(--border);
            border-radius: 12px;
            background: var(--soft)
        }

        .notice a {
            color: var(--primary);
            text-decoration: underline
        }

        .tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0 16px
        }

        .tab {
            appearance: none;
            border: 1px solid var(--border);
            background: #fff;
            padding: 10px 14px;
            border-radius: 999px;
            cursor: pointer;
            font-weight: 700;
            font-size: var(--fs-md);
            transition: .15s
        }

        .tab:hover {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary) 20%, transparent)
        }

        .tab.active {
            border-color: #4169e1;
            color: #ff0000;
            box-shadow: 0 0 0 3px rgba(0, 17, 97, .12)
        }

        .card {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: var(--pad);
            background: #fff;
            box-shadow: var(--shadow)
        }

        .section-title {
            display: inline-block;
            background: #eef2ff;
            color: #1e1b4b;
            border: 1px solid #e0e7ff;
            border-radius: 999px;
            padding: 5px 12px;
            font-weight: 700;
            font-size: var(--fs-sm);
            margin-bottom: 10px
        }

        .row {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--gap)
        }

        @media (min-width:900px) {
            .row {
                grid-template-columns: 1fr 1fr
            }
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 6px
        }

        .field label {
            font-size: var(--fs-sm);
            font-weight: 700;
            color: #0b1324
        }

        .req::after {
            content: " *";
            color: #e11d48
        }

        input {
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            padding: 12px 14px;
            font-size: var(--fs-md);
            outline: none;
            background: #fff;
            transition: border-color .15s, box-shadow .15s, transform .05s
        }

        select,
        textarea {
            width: 100%;
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            padding: 12px 14px;
            font-size: var(--fs-md);
            outline: none;
            background: #fff;
            transition: border-color .15s, box-shadow .15s, transform .05s
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary) 25%, transparent)
        }

        input[type="file"] {
            padding: 10px
        }

        input::placeholder,
        textarea::placeholder {
            font-size: var(--fs-sm);
            color: #94a3b8
        }

        .help {
            font-size: var(--fs-xxs);
            color: #64748b
        }

        .sep {
            border: none;
            border-top: 1px dashed #e2e8f0;
            margin: 16px 0
        }

        .actions {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap
        }

        .btn {
            background: var(--brand);
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 12px 48px;
            font-weight: 800;
            cursor: pointer;
            font-size: var(--fs-md);
            transition: .15s
        }

        .btn:hover {
            background: var(--primary);
            box-shadow: 0 6px 18px color-mix(in srgb, var(--accent) 40%, transparent);
            transform: translateY(-1px)
        }

        .btn:active {
            transform: translateY(0)
        }

        .note {
            font-size: var(--fs-sm);
            color: #475569
        }

        .ok {
            color: #16a34a;
            font-weight: 700
        }

        .err {
            color: #b91c1c;
            font-weight: 700
        }

        .status {
            min-height: 1.4em
        }

        .field.checkline {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
            grid-column: 1 / -1
        }

        .field.checkline input {
            margin: 0;
            min-width: 18px;
            min-height: 18px
        }

        .field.checkline label {
            flex: 1;
            margin: 0;
            line-height: 1.45;
            font-weight: 400
        }

        .ac-wrap {
            position: relative
        }

        .ac-list {
            position: absolute;
            left: 0;
            right: 0;
            top: calc(100% + 6px);
            z-index: 20;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 12px 26px rgba(2, 6, 23, .10);
            max-height: 280px;
            overflow: auto;
            padding: 6px;
            display: none
        }

        .ac-item {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: var(--fs-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px
        }

        .ac-item:hover,
        .ac-item[aria-selected="true"] {
            background: #f1f5ff
        }

        .result-left {
            display: flex;
            flex-direction: column
        }

        .code {
            font-weight: 700
        }

        .name {
            font-size: var(--fs-xs);
            color: #334155
        }

        .pill {
            font-size: var(--fs-xxs);
            color: #1e3a8a;
            background: #eef2ff;
            border: 1px solid #e0e7ff;
            border-radius: 999px;
            padding: 2px 8px
        }

        .subnote {
            margin: -2px 0 10px;
            font-size: var(--fs-sm);
            color: #0b1324;
            background: #fff7ed;
            border: 1px solid #fed7aa;
            padding: 8px 10px;
            border-radius: 10px
        }

        .terms {
            margin: 6px 0 4px 18px;
            padding: 0
        }

        .terms li {
            font-weight: 500;
            margin: 6px 0;
            font-size: var(--fs-sm);
            color: #0b1324
        }

        .toast {
            position: fixed;
            top: 12px;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: #111;
            color: #fff;
            padding: 8px 12px;
            border-radius: 999px;
            font-size: var(--fs-sm);
            box-shadow: 0 6px 18px rgba(0, 0, 0, .18);
            opacity: 0;
            pointer-events: none;
            transition: opacity .18s, transform .18s;
            z-index: 9999
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0)
        }

        @media (max-width:420px) {
            .btn {
                width: 100%
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header class="header" role="banner">
            <div class="head-row">
                <img class="logo"
                    src="https://canstemeducation.com/wp-content/uploads/2023/07/CanSTEM-Education-Private-School.png"
                    alt="CanSTEM Education logo">
                <h1>Course (Withdrawal / Change / Mode Switch) Request Form</h1>
            </div>
        </header>

        <div class="notice" role="note">
            Fill the form and click Submit. Your request will be emailed to
            <strong>frontdesk@canstemeducation.com</strong> automatically. To check the policy, see:
            <a href="https://canstemeducation.com/course-mode-change-terms-policy/" target="_blank" rel="noopener">
                https://canstemeducation.com/course-mode-change-terms-policy/
            </a>
        </div>

        <div class="tabs" role="tablist" aria-label="Request type">
            <button class="tab active" data-tab="withdraw" role="tab" aria-selected="true">Withdraw from Course</button>
            <button class="tab" data-tab="change" role="tab" aria-selected="false">Change Course</button>
            <button class="tab" data-tab="mode" role="tab" aria-selected="false">Switch Mode (Online â†”
                In-Person)</button>
        </div>

        <!-- ===== Withdraw (NO PAYMENT) ===== -->
        <section id="pane-withdraw" class="card" role="tabpanel">
            <span class="section-title">Withdrawal Request â€” Form Details</span>
            <p class="subnote">In order to withdraw â€” please make sure that all the fee is paid to process withdrawal.</p>

            <div class="row">
                <div class="field"><label class="req" for="w-name">Student Full Name</label><input id="w-name" required
                        autocomplete="name" placeholder="First Last"></div>
                <div class="field"><label class="req" for="w-email">Student Email</label><input id="w-email"
                        type="email" required autocomplete="email" placeholder="name@example.com"></div>
                <div class="field"><label class="req" for="w-phone">Phone Number</label><input id="w-phone" type="tel"
                        inputmode="tel" required placeholder="+1 555 555 5555"></div>
                <div class="field">
                    <label class="req" for="w-age">Are you 18 or above?</label>
                    <select id="w-age" required>
                        <option value="">Selectâ€¦</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <div class="field"><label class="req" for="w-grade">Select Grade</label><select id="w-grade"
                        required></select></div>
                <div class="field ac-wrap">
                    <label class="req" for="w-coursecode">Current Course (search by code or name)</label>
                    <input id="w-coursecode" autocomplete="off"
                        placeholder="Start typing (e.g., MHF4U or Advanced Functions)">
                    <div id="w-ac" class="ac-list" role="listbox" aria-label="Course suggestions"></div>
                    <div class="help">Suggestions will appear below as you type.</div>
                </div>
            </div>

            <div class="field"><label class="req" for="w-reason">Reason for Withdrawal</label><textarea id="w-reason"
                    rows="4" required placeholder="Brief reason"></textarea></div>

            <div class="row">
                <div class="field"><label class="req" for="w-stusig">Student Signature</label><input id="w-stusig"
                        required placeholder="Type full name as signature"></div>
                <div class="field" id="w-parentsig-wrap"><label id="w-parentsig-label" for="w-parentsig">Parent/Guardian
                        Signature</label><input id="w-parentsig" placeholder="Parent/guardian full name as signature">
                </div>
            </div>

            <hr class="sep">

            <!-- TERMS -->
            <span class="section-title">Terms &amp; Conditions</span>
            <ul class="terms">
                <li>I have read the policies and terms on the <a
                        href="https://canstemeducation.com/course-mode-change-terms-policy/" target="_blank"
                        rel="noopener">Course Mode Change &amp; Terms page</a>.</li>
                <li>This request is subject to approval.</li>
                <li>All fees already paid are non-refundable; I will not request a refund.</li>
                <li>To reverse a submitted request, I must submit a new request; the same policies apply and it will be
                    treated as a separate request.</li>
            </ul>
            <div class="field checkline">
                <input type="checkbox" id="w-ack" required>
                <label for="w-ack"><strong>I have read and agree to all the terms above.</strong></label>
            </div>

            <hr class="sep">

            <!-- UPLOADS -->
            <span class="section-title">Uploads</span>
            <div class="field">
                <label for="w-files">Upload Supporting Documents (optional)</label>
                <input id="w-files" type="file" multiple>
                <div class="help">You can select multiple files or open the picker again to add more.</div>
            </div>

            <hr class="sep">
            <div class="actions">
                <button class="btn" onclick="submitWithdraw()">Submit</button>
                <span class="note">Attachments are sent with the email to frontdesk.</span>
            </div>
            <p id="w-status" class="note status" aria-live="polite"></p>
        </section>

        <!-- ===== Change (UNCHANGED) ===== -->
        <section id="pane-change" class="card" style="display:none;" role="tabpanel">
            <span class="section-title">Course Change â€” Form Details</span>

            <div class="row">
                <div class="field"><label class="req" for="c-name">Student Full Name</label><input id="c-name" required
                        placeholder="First Last"></div>
                <div class="field"><label class="req" for="c-email">Student Email</label><input id="c-email"
                        type="email" required placeholder="name@example.com"></div>
                <div class="field"><label class="req" for="c-phone">Phone Number</label><input id="c-phone" type="tel"
                        inputmode="tel" required placeholder="+1 555 555 5555"></div>
                <div class="field">
                    <label class="req" for="c-age">Are you 18 or above?</label>
                    <select id="c-age" required>
                        <option value="">Selectâ€¦</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <div class="field"><label class="req" for="c-grade">Select Grade</label><select id="c-grade"
                        required></select></div>
                <div class="field ac-wrap">
                    <label class="req" for="c-coursecode">Current Course (search by code or name)</label>
                    <input id="c-coursecode" autocomplete="off" placeholder="Start typing (e.g., ENG3U or English)">
                    <div id="c-ac" class="ac-list" role="listbox" aria-label="Course suggestions"></div>
                </div>
                <div class="field"><label class="req" for="c-grade2">New Requested Course â€“ Grade</label><select
                        id="c-grade2" required></select></div>
                <div class="field ac-wrap">
                    <label class="req" for="c-newcode">New Requested Course (search by code or name)</label>
                    <input id="c-newcode" autocomplete="off"
                        placeholder="Start typing (e.g., ICS4U or Computer Science)">
                    <div id="c-ac2" class="ac-list" role="listbox" aria-label="Course suggestions"></div>
                </div>
            </div>

            <div class="field"><label class="req" for="c-reason">Reason for Change</label><textarea id="c-reason"
                    rows="4" required placeholder="Brief reason"></textarea></div>

            <div class="row">
                <div class="field"><label class="req" for="c-stusig">Student Signature</label><input id="c-stusig"
                        required placeholder="Type full name as signature"></div>
                <div class="field" id="c-parentsig-wrap"><label id="c-parentsig-label" for="c-parentsig">Parent/Guardian
                        Signature</label><input id="c-parentsig" placeholder="Parent/guardian full name as signature">
                </div>
            </div>

            <hr class="sep">

            <!-- PAYMENT (kept for Change) -->
            <span class="section-title">Payment</span>
            <div class="notice">Please complete payment here: <a href="https://canstemeducation.com/payment/"
                    target="_blank" rel="noopener">https://canstemeducation.com/payment/</a></div>
            <div class="field checkline">
                <input type="checkbox" id="c-paid">
                <label for="c-paid"><strong>I made the payment on the above page and understand processing starts after
                        verification.</strong></label>
            </div>

            <hr class="sep">

            <!-- TERMS -->
            <span class="section-title">Terms &amp; Conditions</span>
            <ul class="terms">
                <li>I have read the policies, fees and terms on the <a
                        href="https://canstemeducation.com/course-mode-change-terms-policy/" target="_blank"
                        rel="noopener">Course Mode Change &amp; Terms page</a>.</li>
                <li>This request is subject to approval.</li>
                <li>All fees are non-refundable; I will not request a refund.</li>
                <li>To reverse a submitted request, I must submit a new request; the same fees apply and it will be
                    treated as a separate request.</li>
                <li><strong>I have completed the prerequisite for the requested course; otherwise my request will not be
                        accepted.</strong></li>
                <li><strong>I will submit proof of the prerequisite along with this request (see uploads
                        below).</strong></li>
            </ul>
            <div class="field checkline">
                <input type="checkbox" id="c-ack" required>
                <label for="c-ack"><strong>I have read and agree to all the terms above.</strong></label>
            </div>

            <hr class="sep">

            <!-- UPLOADS -->
            <span class="section-title">Uploads</span>
            <div class="field"><label for="c-up-payment">Proof of Payment</label><input id="c-up-payment" type="file"
                    multiple></div>
            <div class="field"><label for="c-prereq">Proof of Prerequisite Subject(s)</label><input id="c-prereq"
                    type="file" multiple></div>
            <div class="field">
                <label for="c-files">Upload Supporting Documents</label>
                <input id="c-files" type="file" multiple>
                <div class="help">You can select multiple files or open the picker again to add more.</div>
            </div>

            <hr class="sep">
            <div class="actions">
                <button class="btn" onclick="submitChange()">Submit</button>
                <span class="note">Attachments are sent with the email to frontdesk.</span>
            </div>
            <p id="c-status" class="note status" aria-live="polite"></p>
        </section>

        <!-- ===== Mode (UNCHANGED) ===== -->
        <section id="pane-mode" class="card" style="display:none;" role="tabpanel">
            <span class="section-title">Course Mode Switch â€” Form Details</span>

            <div class="row">
                <div class="field"><label class="req" for="m-name">Student Full Name</label><input id="m-name" required
                        placeholder="First Last"></div>
                <div class="field"><label class="req" for="m-email">Student Email</label><input id="m-email"
                        type="email" required placeholder="name@example.com"></div>
                <div class="field"><label class="req" for="m-phone">Phone Number</label><input id="m-phone" type="tel"
                        inputmode="tel" required placeholder="+1 555 555 5555"></div>
                <div class="field">
                    <label class="req" for="m-age">Are you 18 or above?</label>
                    <select id="m-age" required>
                        <option value="">Selectâ€¦</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <div class="field"><label class="req" for="m-grade">Select Grade</label><select id="m-grade"
                        required></select></div>
                <div class="field ac-wrap">
                    <label class="req" for="m-coursecode">Current Course (search by code or name)</label>
                    <input id="m-coursecode" autocomplete="off"
                        placeholder="Start typing (e.g., MDM4U or Data Management)">
                    <div id="m-ac" class="ac-list" role="listbox" aria-label="Course suggestions"></div>
                </div>
                <div class="field">
                    <label class="req" for="m-currentmode">Current Mode</label>
                    <select id="m-currentmode" required>
                        <option value="">Select current modeâ€¦</option>
                        <option>Online</option>
                        <option>In-Person</option>
                    </select>
                </div>
                <div class="field">
                    <label class="req" for="m-mode">Requested Mode</label>
                    <select id="m-mode" required>
                        <option value="">Select requested modeâ€¦</option>
                        <option>Online</option>
                        <option>In-Person</option>
                    </select>
                </div>
            </div>

            <div class="field"><label class="req" for="m-reason">Reason for Mode Switch</label><textarea id="m-reason"
                    rows="4" required placeholder="Brief reason"></textarea></div>

            <div class="row">
                <div class="field"><label class="req" for="m-stusig">Student Signature</label><input id="m-stusig"
                        required placeholder="Type full name as signature"></div>
                <div class="field" id="m-parentsig-wrap"><label id="m-parentsig-label" for="m-parentsig">Parent/Guardian
                        Signature</label><input id="m-parentsig" placeholder="Parent/guardian full name as signature">
                </div>
            </div>

            <hr class="sep">

            <!-- PAYMENT (kept for Mode) -->
            <span class="section-title">Payment</span>
            <div class="notice">Please complete payment here: <a href="https://canstemeducation.com/payment/"
                    target="_blank" rel="noopener">https://canstemeducation.com/payment/</a></div>
            <div class="field checkline">
                <input type="checkbox" id="m-paid">
                <label for="m-paid"><strong>I made the payment on the above page and understand processing starts after
                        verification.</strong></label>
            </div>

            <hr class="sep">

            <!-- TERMS -->
            <span class="section-title">Terms &amp; Conditions</span>
            <ul class="terms">
                <li>I have read the policies, fees and terms on the <a
                        href="https://canstemeducation.com/course-mode-change-terms-policy/" target="_blank"
                        rel="noopener">Course Mode Change &amp; Terms page</a>.</li>
                <li>This request is subject to approval.</li>
                <li>All fees are non-refundable; I will not request a refund.</li>
                <li>To reverse a submitted request, I must submit a new request; the same fees apply and it will be
                    treated as a separate request.</li>
            </ul>
            <div class="field checkline">
                <input type="checkbox" id="m-ack" required>
                <label for="m-ack"><strong>I have read and agree to all the terms above.</strong></label>
            </div>

            <hr class="sep">

            <!-- UPLOADS -->
            <span class="section-title">Uploads</span>
            <div class="field"><label for="m-up-payment">Proof of Payment</label><input id="m-up-payment" type="file"
                    multiple></div>
            <div class="field">
                <label for="m-files">Upload Supporting Documents</label>
                <input id="m-files" type="file" multiple>
                <div class="help">You can select multiple files or open the picker again to add more.</div>
            </div>

            <hr class="sep">
            <div class="actions">
                <button class="btn" onclick="submitMode()">Submit</button>
                <span class="note">Attachments are sent with the email to frontdesk.</span>
            </div>
            <p id="m-status" class="note status" aria-live="polite"></p>
        </section>
    </div>

    <!-- toast -->
    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script>
        /* ===== DATA (code + name by grade) ===== */
        const D9 = [{ code: "AVI1O", name: "Visual Arts" }, { code: "ADA1O", name: "Drama" }, { code: "BEM1O", name: "Building The Entrepreneurial Mindset" }, { code: "CGC1W", name: "Issues in Canadian Geography (De-Streamed)" }, { code: "ENL1W", name: "English (De-Streamed)" }, { code: "EAE1W", name: "English (French OSSD), De-Streamed" }, { code: "ENG1L", name: "English (LDCC)" }, { code: "FSF1D", name: "French (De-Streamed)" }, { code: "FSF1O", name: "Core French (Open)" }, { code: "GLS1O", name: "Learning Strategies 1: Skills for Success" }, { code: "GLE1O", name: "Learning Strategies 1: Skills for Success" }, { code: "HFN1O", name: "Food and Nutrition" }, { code: "HIF1O", name: "Exploring Family Studies" }, { code: "PPL1O", name: "Healthy Active Living Education" }, { code: "MTH1W", name: "Mathematics (De-Streamed)" }, { code: "MAT1L", name: "Mathematics (LDCC)" }, { code: "SNC1W", name: "Science (De-Streamed)" }, { code: "SNC1L", name: "Science (LDCC)" }, { code: "TIJ1O", name: "Exploring Technologies" }, { code: "TAS1O", name: "Technology and the Skilled Trades" }, { code: "NONE", name: "Not in the list" }];
        const D10 = [{ code: "AVI2O", name: "Visual Arts (G10)" }, { code: "ADA2O", name: "Drama (G10)" }, { code: "ASM2O", name: "Media Arts (G10)" }, { code: "BEP2O", name: "Launching and Leading a Business (G10)" }, { code: "CHC2D", name: "Canadian History Since WWI (Academic)" }, { code: "CHC2P", name: "Canadian History Since WWI (Applied)" }, { code: "CHV2O", name: "Civics and Citizenship" }, { code: "ENG2D", name: "English (Academic)" }, { code: "ENG2P", name: "English (Applied)" }, { code: "ENG2L", name: "English (LDCC)" }, { code: "EAE2D", name: "English (French OSSD, Academic)" }, { code: "FSF2D", name: "French (Academic)" }, { code: "FSF2O", name: "Core French (Open)" }, { code: "FSF2P", name: "Core French (Applied)" }, { code: "GLC2O", name: "Career Studies" }, { code: "HIF2O", name: "Individual and Family Living" }, { code: "HFN2O", name: "Food and Nutrition (G10)" }, { code: "ICS2O", name: "Introduction to Computer Studies" }, { code: "ICD2O", name: "Digital Technology & Innovations" }, { code: "MPM2D", name: "Principles of Mathematics (Academic)" }, { code: "MFM2P", name: "Foundations of Mathematics (Applied)" }, { code: "MAT2L", name: "Mathematics (LDCC)" }, { code: "PPL2O", name: "Healthy Active Living Education (G10)" }, { code: "SNC2D", name: "Science (Academic)" }, { code: "SNC2P", name: "Science (Applied)" }, { code: "SNC2L", name: "Science (LDCC)" }, { code: "RGJ2O", name: "Communications Technology (G10)" }, { code: "TEJ2O", name: "Computer Technology (G10)" }, { code: "TFJ2O", name: "Hospitality and Tourism (G10)" }, { code: "TDJ2O", name: "Technological Design (G10)" }, { code: "TAS2O", name: "Technology and the Skilled Trades (G10)" }, { code: "NONE", name: "Not in the list" }];
        const D11 = [{ code: "AVI3M", name: "Visual Arts (U/C)" }, { code: "AVI3O", name: "Visual Arts (Open)" }, { code: "ADA3M", name: "Drama (U/C)" }, { code: "ADA3O", name: "Drama (Open)" }, { code: "ASM3M", name: "Media Arts (U/C)" }, { code: "ASM3O", name: "Media Arts (Open)" }, { code: "BAF3M", name: "Financial Accounting Fundamentals" }, { code: "BAI3E", name: "Accounting Essentials (Workplace)" }, { code: "BDI3C", name: "Entrepreneurship: The Venture" }, { code: "BDP3O", name: "Entrepreneurship: The Enterprising Person" }, { code: "BTA3O", name: "ICT: The Digital Environment" }, { code: "BMI3C", name: "Marketing: Goods, Services, Events" }, { code: "CIE3M", name: "The Individual and the Economy" }, { code: "CGD3M", name: "Regional Geography" }, { code: "CGF3M", name: "Forces of Nature" }, { code: "CGT3O", name: "Intro to Spatial Technologies (Open)" }, { code: "CGG3O", name: "Travel & Tourism" }, { code: "CHA3U", name: "American History" }, { code: "CHW3U", name: "World History to 15th Century" }, { code: "CHT3O", name: "World History since 1900 (Open)" }, { code: "CLU3M", name: "Understanding Canadian Law" }, { code: "CPC3O", name: "Politics in Action: Making Change" }, { code: "ENG3C", name: "English (College)" }, { code: "ENG3U", name: "English (University)" }, { code: "ENG3E", name: "English (Workplace)" }, { code: "EAE3U", name: "English (French OSSD, University)" }, { code: "EPS3O", name: "Presentation and Speaking Skills" }, { code: "EMS3O", name: "Media Studies (Open)" }, { code: "FSF3U", name: "Core French (University)" }, { code: "FSF3O", name: "Core French (Open)" }, { code: "FEF3U", name: "Extended French (University)" }, { code: "FIF3U", name: "French Immersion (University)" }, { code: "FIF3O", name: "French Immersion (Open)" }, { code: "GWL3O", name: "Designing Your Future" }, { code: "HSG3M", name: "Gender Studies" }, { code: "HSE3E", name: "Equity & Social Justice (Workplace)" }, { code: "HFC3M", name: "Food and Culture" }, { code: "HPW3C", name: "Working with Infants & Young Children" }, { code: "HZB3M", name: "Philosophy: The Big Questions" }, { code: "HRT3M", name: "World Religions" }, { code: "HPC3O", name: "Raising Healthy Children" }, { code: "HSP3U", name: "Intro to Anthropology (University)" }, { code: "HSP3C", name: "Anthro/Psych/Soc (College)" }, { code: "ICS3C", name: "Intro to Computer Programming (College)" }, { code: "ICS3U", name: "Intro to Computer Science (University)" }, { code: "IDC3O", name: "Sports & Entertainment Marketing (Open)" }, { code: "MBF3C", name: "Foundations for College Mathematics" }, { code: "MCF3M", name: "Functions and Applications" }, { code: "MCR3U", name: "Functions" }, { code: "MEL3E", name: "Math for Work & Everyday Life (Workplace)" }, { code: "PPL3O", name: "Healthy Active Living Education" }, { code: "PPZ3C", name: "Health for Life" }, { code: "SBI3C", name: "Biology (College)" }, { code: "SBI3U", name: "Biology (University)" }, { code: "SCH3U", name: "Chemistry (University)" }, { code: "SPH3U", name: "Physics (University)" }, { code: "SVN3M", name: "Environmental Science (U/C)" }, { code: "SVN3E", name: "Environmental Science (Workplace)" }, { code: "TEI3M", name: "Computer Eng. Tech: Interfacing (U/C)" }, { code: "TEJ3M", name: "Computer Engineering Technology (U/C)" }, { code: "TEL3M", name: "Computer Eng. Tech: Electronics (U/C)" }, { code: "TEN3M", name: "Computer Eng. Tech: Networking (U/C)" }, { code: "TET3E", name: "Computer Technology: IT Support" }, { code: "TEW3E", name: "Computer Technology: Network Support" }, { code: "TGJ3M", name: "Communications Technology (U/C)" }, { code: "TFE3E", name: "Hospitality & Tourism: Event Planning (W)" }, { code: "TFJ3E", name: "Hospitality & Tourism (Workplace)" }, { code: "TFJC", name: "Hospitality & Tourism (College)" }, { code: "TDJ3M", name: "Technological Design (U/C)" }, { code: "TGJ3O", name: "Communications Tech: Broadcast/Print" }, { code: "TDJ3O", name: "Technological Design and the Environment" }, { code: "TGI3M", name: "Interactive New Media & Animation (U/C)" }, { code: "TGP3M", name: "Photography & Digital Imaging (U/C)" }, { code: "TPD3M", name: "Health Care: Dental Services (U/C)" }, { code: "TPL3M", name: "Health Care: Laboratory Services (U/C)" }, { code: "TPM3M", name: "Health Care: Nursing/Medical Services (U/C)" }, { code: "TPP3M", name: "Health Services: Pharmacy (U/C)" }, { code: "TPT3M", name: "Health Care: Therapy Services (U/C)" }, { code: "TPJ3C", name: "Health Care (College)" }, { code: "TPJ3M", name: "Health Care (U/C)" }, { code: "NONE", name: "Not in the list" }];
        const D12 = [{ code: "ADA4E", name: "Drama (Workplace)" }, { code: "ADA4M", name: "Drama (U/C)" }, { code: "AEA4O", name: "Exploring & Creating in the Arts" }, { code: "ASM4M", name: "Media Arts (U/C)" }, { code: "ASM4E", name: "Media Arts (Workplace)" }, { code: "AVI4M", name: "Visual Arts (U/C)" }, { code: "BAT4M", name: "Financial Accounting Principles" }, { code: "BDV4C", name: "Entrepreneurship: Venture Planning (C)" }, { code: "BTX4C", name: "ICT: Multimedia Solutions (C)" }, { code: "BBB4M", name: "International Business Fundamentals" }, { code: "BOH4M", name: "Business Leadership" }, { code: "CIA4U", name: "Analysing Current Economic Issues" }, { code: "CGW4U", name: "World Issues (University)" }, { code: "CGW4C", name: "World Issues (College)" }, { code: "CGR4M", name: "Environment & Resource Management" }, { code: "CGO4M", name: "Spatial Technologies in Action" }, { code: "CGU4M", name: "World Geography: Urban Patterns" }, { code: "CHY4U", name: "World History since 15th Century (U)" }, { code: "CHY4C", name: "World History since 15th Century (C)" }, { code: "CHI4U", name: "Canada: History, Identity & Culture" }, { code: "CLN4U", name: "Canadian & International Law (U)" }, { code: "CLN4C", name: "Legal Studies (College)" }, { code: "CPW4U", name: "Canadian & International Politics" }, { code: "ENG4U", name: "English (University)" }, { code: "ENG4C", name: "English (College)" }, { code: "ENG4E", name: "English (Workplace)" }, { code: "EAE4U", name: "English (French OSSD, University)" }, { code: "EWC4U", name: "The Writerâ€™s Craft (University)" }, { code: "EWC4C", name: "The Writerâ€™s Craft (College)" }, { code: "FSF4U", name: "Core French (University)" }, { code: "FSF4O", name: "Core French (Open)" }, { code: "HSE4M", name: "Equity & Social Justice" }, { code: "HSC4M", name: "World Cultures" }, { code: "HFA4U", name: "Nutrition & Health (University)" }, { code: "HFA4C", name: "Nutrition & Health (College)" }, { code: "HHS4U", name: "Families in Canada (University)" }, { code: "HHS4C", name: "Families in Canada (College)" }, { code: "HHG4M", name: "Human Development Through the Life Span" }, { code: "HIP4O", name: "Personal Life Management" }, { code: "HPD4C", name: "Working with School-Age Children & Adolescents" }, { code: "HSB4U", name: "Challenge & Change in Society" }, { code: "HZT4U", name: "Philosophy: Questions & Theories" }, { code: "ICS4U", name: "Computer Science (University)" }, { code: "ICS4C", name: "Computer Programming (College)" }, { code: "IDC4U", name: "Sports & Entertainment Marketing (U)" }, { code: "IDC4O", name: "Sports & Entertainment Marketing (Open)" }, { code: "MHF4U", name: "Advanced Functions" }, { code: "MCV4U", name: "Calculus and Vectors" }, { code: "MDM4U", name: "Mathematics of Data Management" }, { code: "MCT4C", name: "Mathematics for College Technology" }, { code: "MAP4C", name: "Foundations for College Mathematics" }, { code: "MEL4E", name: "Math for Work & Everyday Life (Workplace)" }, { code: "OLC4O", name: "Ontario Secondary School Literacy Course" }, { code: "PPL4O", name: "Healthy Active Living Education" }, { code: "PLF4M", name: "Recreation & Healthy Active Living Leadership" }, { code: "PSK4U", name: "Introductory Kinesiology" }, { code: "SBI4U", name: "Biology (University)" }, { code: "SCH4C", name: "Chemistry (College)" }, { code: "SCH4U", name: "Chemistry (University)" }, { code: "SPH4U", name: "Physics (University)" }, { code: "SES4U", name: "Earth and Space Science" }, { code: "SNC4M", name: "Science (U/C)" }, { code: "SNC4E", name: "Science (Workplace)" }, { code: "TGJ4M", name: "Communications Technology (U/C)" }, { code: "TGJ4O", name: "Communications Tech: Digital Imagery & Web" }, { code: "TEJ4M", name: "Computer Engineering Technology (U/C)" }, { code: "TFJ4E", name: "Hospitality & Tourism (Workplace)" }, { code: "TFJ4C", name: "Hospitality & Tourism (College)" }, { code: "TDJ4M", name: "Technological Design (U/C)" }, { code: "TDJ4O", name: "Technological Design in the 21st Century" }, { code: "TEI4M", name: "Computer Eng. Tech: Interfacing (U/C)" }, { code: "TEN4M", name: "Computer Eng. Tech: Networking" }, { code: "TET4E", name: "Computer Technology: IT Support" }, { code: "TEW4E", name: "Computer Technology: Network Support" }, { code: "TGI4M", name: "Interactive New Media & Animation" }, { code: "TGP4M", name: "Photography & Digital Imaging" }, { code: "TOC4C", name: "Child Development" }, { code: "TOG4C", name: "Gerontology" }, { code: "TPD4M", name: "Health Care: Dental Services" }, { code: "TPL4M", name: "Health Care: Laboratory Services" }, { code: "TPM4M", name: "Health Care: Nursing/Medical Services" }, { code: "TPP4M", name: "Health Services: Pharmacy" }, { code: "TPT4M", name: "Health Care: Therapy Services" }, { code: "TPJ4C", name: "Health Care (College)" }, { code: "TPJ4E", name: "Health Care (Workplace)" }, { code: "TPJ4M", name: "Health Care (U/C)" }, { code: "NONE", name: "Not in the list" }];
        const DESL = [{ code: "NONE", name: "Not in the list" }, { code: "ESLAO", name: "ESL Level 1" }, { code: "ESLBO", name: "ESL Level 2" }, { code: "ESLCO", name: "ESL Level 3" }, { code: "ESLDO", name: "ESL Level 4" }, { code: "ESLEO", name: "ESL Level 5" }, { code: "ELDAO", name: "ELD Level 1" }, { code: "ELDBO", name: "ELD Level 2" }, { code: "ELDCO", name: "ELD Level 3" }, { code: "ELDDO", name: "ELD Level 4" }, { code: "ELDEO", name: "ELD Level 5" }];

        const GRADES = ["Select grade...", "Grade 9", "Grade 10", "Grade 11", "Grade 12", "ESL/ELD Courses"];
        const listFor = g => ({ "Grade 9": D9, "Grade 10": D10, "Grade 11": D11, "Grade 12": D12, "ESL/ELD Courses": DESL }[g] || []);
        const codesFor = g => listFor(g).map(x => x.code);
        const nameFor = (g, c) => { const f = listFor(g).find(x => x.code === c); return f ? f.name : "" };

        function populateGrade(id) { const s = document.getElementById(id); if (s.dataset.ready) return; GRADES.forEach(g => { const o = document.createElement('option'); o.value = g; o.textContent = g; s.appendChild(o) }); s.value = GRADES[0]; s.dataset.ready = "1"; }

        function attachAutocomplete(inputId, listId, gradeSelId) {
            const input = document.getElementById(inputId);
            const list = document.getElementById(listId);
            const gradeSel = document.getElementById(gradeSelId);
            let active = -1;
            function hide() { list.style.display = 'none' }
            function render() {
                const q = input.value.trim().toUpperCase();
                const data = listFor(gradeSel.value);
                const items = !q ? data.slice(0, 20) : data.filter(({ code, name }) => (code + " " + name).toUpperCase().includes(q)).slice(0, 20);
                list.innerHTML = '';
                items.forEach((it, idx) => {
                    const div = document.createElement('div'); div.className = 'ac-item'; div.role = 'option'; div.id = listId + '-' + idx;
                    div.innerHTML = `<div class="result-left"><span class="code">${it.code}</span><span class="name">${it.name}</span></div><span class="pill">${gradeSel.value}</span>`;
                    div.addEventListener('click', () => { input.value = it.code; hide() });
                    list.appendChild(div);
                });
                list.style.display = items.length ? 'block' : 'none'; active = -1;
            }
            input.addEventListener('input', render);
            input.addEventListener('focus', render);
            input.addEventListener('blur', () => setTimeout(hide, 150));
            gradeSel.addEventListener('change', render);
            input.addEventListener('keydown', e => {
                const items = [...list.querySelectorAll('.ac-item')]; if (!items.length) return;
                if (e.key === 'ArrowDown') { e.preventDefault(); active = Math.min(active + 1, items.length - 1) }
                else if (e.key === 'ArrowUp') { e.preventDefault(); active = Math.max(active - 1, 0) }
                else if (e.key === 'Enter') { if (active >= 0) { e.preventDefault(); items[active].click() } }
                else if (e.key === 'Escape') { hide() }
                items.forEach(i => i.setAttribute('aria-selected', 'false'));
                if (active >= 0) { items[active].setAttribute('aria-selected', 'true'); items[active].scrollIntoView({ block: 'nearest' }) }
            });
        }

        const validateCourseCode = (grade, code) => codesFor(grade).includes(code);

        /* Tabs */
        document.querySelector('.tabs').addEventListener('click', e => {
            if (!e.target.classList.contains('tab')) return;
            document.querySelectorAll('.tab').forEach(t => { t.classList.remove('active'); t.setAttribute('aria-selected', 'false') });
            e.target.classList.add('active'); e.target.setAttribute('aria-selected', 'true');
            const tab = e.target.dataset.tab;
            document.querySelectorAll('[role="tabpanel"]').forEach(p => p.style.display = 'none');
            document.getElementById('pane-' + tab).style.display = 'block';
        });

        /* Files */
        function fileToBase64(file) { return new Promise((res, rej) => { const r = new FileReader(); r.onload = () => { const out = (r.result || ''); const b64 = (out.split('base64,')[1] || '').trim(); res({ name: file.name, mimeType: file.type || 'application/octet-stream', dataBase64: b64 }) }; r.onerror = () => rej(r.error); r.readAsDataURL(file) }) }
        async function collectAttachments(ids) { const out = []; for (const id of ids) { const input = document.getElementById(id); if (input && input.files && input.files.length) { for (const f of [...input.files]) out.push(await fileToBase64(f)); } } return out; }

        /* Toast */
        function toast(msg) { const el = document.getElementById('toast'); el.textContent = msg; el.classList.add('show'); clearTimeout(el._t); el._t = setTimeout(() => el.classList.remove('show'), 1600); }

        /* Disable course until grade selected */
        function wireDisableFor(inputId, gradeSelId) {
            const input = document.getElementById(inputId);
            const grade = document.getElementById(gradeSelId);
            const setState = () => { const need = !(grade && grade.value && grade.value !== 'Select grade...'); input.disabled = need; };
            setState();
            grade.addEventListener('change', setState);
            ['mousedown', 'mouseenter', 'touchstart', 'focus'].forEach(ev => {
                input.addEventListener(ev, (e) => { if (input.disabled) { e.preventDefault(); input.blur(); toast('Please select grade first'); } }, { passive: false });
            });
        }

        /* Validation */
        function isValid(paneId) {
            const pane = document.getElementById(paneId);
            const req = pane.querySelectorAll('[required]');
            for (const el of req) {
                if (el.type === 'checkbox' && !el.checked) { el.focus(); return false; }
                if (!el.value || (el.tagName === 'SELECT' && !el.value)) { el.focus(); return false; }
            }
            return true;
        }
        function showStatus(id, msg, ok) {
            const el = document.getElementById(id);
            el.classList.remove('ok', 'err'); el.textContent = msg; el.classList.add(ok ? 'ok' : 'err');
            if (ok) {
                const pane = el.closest('[role="tabpanel"]');
                pane.querySelectorAll('input,textarea,select').forEach(x => {
                    if (x.type === 'file') { x.value = ''; }
                    else if (x.type === 'checkbox') { x.checked = false; }
                    else { x.value = ''; }
                });
                initAll();
            }
        }
        const val = id => (document.getElementById(id)?.value || '').trim();

        /* Age gate */
        function setupAgeGate(prefix) {
            const sel = document.getElementById(`${prefix}-age`);
            const wrap = document.getElementById(`${prefix}-parentsig-wrap`);
            const input = document.getElementById(`${prefix}-parentsig`);
            const label = document.getElementById(`${prefix}-parentsig-label`);
            const update = () => { const isAdult = sel.value === 'yes'; if (isAdult) { input.required = false; wrap.style.display = 'none' } else { wrap.style.display = ''; input.required = true; label.classList.add('req') } }; update(); sel.addEventListener('change', update);
        }

        /* Submitters */
        async function submitWithdraw() {
            if (!isValid('pane-withdraw')) return;
            const grade = val('w-grade'), code = val('w-coursecode');
            if (!validateCourseCode(grade, code)) { alert('Please choose a valid course code for the selected grade.'); return; }
            document.getElementById('w-status').textContent = 'Submitting...';
            const attachments = await collectAttachments(['w-files']); // In order to withdraw â€” please make sure that all the fee is paid to process withdrawal.
            const payload = {
                type: 'Withdrawal',
                name: val('w-name'), email: val('w-email'), phone: val('w-phone'),
                grade, courseCode: code, isAdult: (val('w-age') === 'yes'),
                studentSig: val('w-stusig'), parentSig: val('w-parentsig'),
                reason: val('w-reason'), attachments,
                // intentionally no paidConfirmed / hasPayment for withdrawal
                hasSupporting: document.getElementById('w-files').files.length > 0
            };
            google.script.run
                .withSuccessHandler(() => showStatus('w-status', 'Success! Your request has been emailed to the front desk.', true))
                .withFailureHandler(() => showStatus('w-status', 'Error sending your request. Please try again.', false))
                .sendToFrontDesk(payload);
        }

        async function submitChange() {
            if (!isValid('pane-change')) return;
            const gradeCur = val('c-grade'), codeCur = val('c-coursecode');
            const gradeNew = val('c-grade2'), codeNew = val('c-newcode');
            if (!validateCourseCode(gradeCur, codeCur)) { alert('Please pick a valid Current Course for the selected grade.'); return; }
            if (!validateCourseCode(gradeNew, codeNew)) { alert('Please pick a valid NEW course code for the selected grade.'); return; }
            document.getElementById('c-status').textContent = 'Submitting...';
            const attachments = await collectAttachments(['c-up-payment', 'c-prereq', 'c-files']);
            const payload = {
                type: 'Change Course',
                name: val('c-name'), email: val('c-email'), phone: val('c-phone'),
                grade: gradeCur, courseCode: codeCur,
                newcourse: `${codeNew} â€“ ${nameFor(gradeNew, codeNew)}`,
                isAdult: (val('c-age') === 'yes'),
                studentSig: val('c-stusig'), parentSig: val('c-parentsig'),
                reason: val('c-reason'), attachments,
                paidConfirmed: document.getElementById('c-paid').checked,
                hasPayment: document.getElementById('c-up-payment').files.length > 0,
                hasPrereq: document.getElementById('c-prereq').files.length > 0,
                hasSupporting: document.getElementById('c-files').files.length > 0
            };
            google.script.run
                .withSuccessHandler(() => showStatus('c-status', 'Success! Your request has been emailed to the front desk.', true))
                .withFailureHandler(() => showStatus('c-status', 'Error sending your request. Please try again.', false))
                .sendToFrontDesk(payload);
        }

        async function submitMode() {
            if (!isValid('pane-mode')) return;
            const grade = val('m-grade'), code = val('m-coursecode');
            if (!validateCourseCode(grade, code)) { alert('Please choose a valid course code for the selected grade.'); return; }
            document.getElementById('m-status').textContent = 'Submitting...';
            const attachments = await collectAttachments(['m-up-payment', 'm-files']);
            const payload = {
                type: 'Mode Switch',
                name: val('m-name'), email: val('m-email'), phone: val('m-phone'),
                grade, courseCode: code, currentMode: val('m-currentmode'), mode: val('m-mode'),
                isAdult: (val('m-age') === 'yes'),
                studentSig: val('m-stusig'), parentSig: val('m-parentsig'),
                reason: val('m-reason'), attachments,
                paidConfirmed: document.getElementById('m-paid').checked,
                hasPayment: document.getElementById('m-up-payment').files.length > 0,
                hasSupporting: document.getElementById('m-files').files.length > 0
            };
            google.script.run
                .withSuccessHandler(() => showStatus('m-status', 'Success! Your request has been emailed to the front desk.', true))
                .withFailureHandler(() => showStatus('m-status', 'Error sending your request. Please try again.', false))
                .sendToFrontDesk(payload);
        }

        /* Init */
        function initAll() {
            ['w-grade', 'c-grade', 'c-grade2', 'm-grade'].forEach(populateGrade);
            attachAutocomplete('w-coursecode', 'w-ac', 'w-grade');
            attachAutocomplete('c-coursecode', 'c-ac', 'c-grade');
            attachAutocomplete('c-newcode', 'c-ac2', 'c-grade2');
            attachAutocomplete('m-coursecode', 'm-ac', 'm-grade');
            wireDisableFor('w-coursecode', 'w-grade');
            wireDisableFor('c-coursecode', 'c-grade');
            wireDisableFor('c-newcode', 'c-grade2');
            wireDisableFor('m-coursecode', 'm-grade');
            setupAgeGate('w'); setupAgeGate('c'); setupAgeGate('m');
        }
        window.addEventListener('DOMContentLoaded', initAll);
    </script>
</body>

</html>