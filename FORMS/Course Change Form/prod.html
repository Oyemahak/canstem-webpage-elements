<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Course Request (Withdraw / Change / Mode)</title>

    <style>
        /* Force a white page background ONLY on pages that include our forms */
        html:has(#cs-exam),
        body:has(#cs-exam),
        html:has(#cs-req),
        body:has(#cs-req) {
            background-color: #fff !important;
        }

        /* If an Elementor section around the form has a background, neutralize it */
        .elementor-section:has(#cs-exam),
        .elementor-section:has(#cs-req) {
            background-color: #fff !important;
        }

        /* ===================== Elementor Kit containment (buttons/tabs) ===================== */
        /* Our primary action button */
        body.elementor-kit-465 :is(#cs-exam, #cs-req) .cs-btn {
            background: var(--cs-primary) !important;
            color: var(--cs-primary-ink) !important;
            border: none !important;
            box-shadow: none !important;
        }

        body.elementor-kit-465 :is(#cs-exam, #cs-req) .cs-btn:hover,
        body.elementor-kit-465 :is(#cs-exam, #cs-req) .cs-btn:focus {
            filter: brightness(1.05);
            outline: none;
            box-shadow: 0 0 0 3px color-mix(in srgb, #4169e1 25%, transparent) !important;
        }

        /* Tabs: KEEP them as white pills with borders (not Elementor blue buttons) */
        body.elementor-kit-465 :is(#cs-exam, #cs-req) .cs-tab {
            background: #fff !important;
            color: var(--cs-ink) !important;
            border: 1px solid var(--cs-line) !important;
            box-shadow: none !important;
        }

        body.elementor-kit-465 :is(#cs-exam, #cs-req) .cs-tab:hover,
        body.elementor-kit-465 :is(#cs-exam, #cs-req) .cs-tab:focus {
            border-color: #4169e1 !important;
            box-shadow: 0 0 0 3px color-mix(in srgb, #4169e1 20%, transparent) !important;
            outline: none !important;
        }

        body.elementor-kit-465 :is(#cs-exam, #cs-req) .cs-tab.is-active {
            background: #fff !important;
            color: #ff0000 !important;
            /* your active tab text color */
            border-color: #4169e1 !important;
            box-shadow: 0 0 0 3px rgba(0, 17, 97, .12) !important;
        }

        /* Any other "button-like" elements inside our forms: neutralize Elementor kit */
        body.elementor-kit-465 :is(#cs-exam, #cs-req) button:not(.cs-btn):not(.cs-tab),
        body.elementor-kit-465 :is(#cs-exam, #cs-req) input[type="submit"],
        body.elementor-kit-465 :is(#cs-exam, #cs-req) input[type="button"],
        body.elementor-kit-465 :is(#cs-exam, #cs-req) .elementor-button {
            background: initial !important;
            color: inherit !important;
            border: initial !important;
            box-shadow: none !important;
        }

        /* ===================== Scoped form styles (unchanged) ===================== */
        #cs-req,
        #cs-req * {
            box-sizing: border-box;
        }

        #cs-req {
            --cs-bg: #fff;
            --cs-ink: #0b1324;
            --cs-sub: #475569;
            --cs-line: #e5e7eb;
            --cs-primary: #001161;
            --cs-primary-ink: #fff;
            --cs-chip-bg: #eef2ff;
            --cs-chip-ink: #1e1b4b;
            max-width: 1200px;
            color: var(--cs-ink);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }

        /* Title (optional) */
        #cs-req .cs-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--cs-primary);
            margin: 4px 0 10px;
        }

        #cs-req .cs-desc {
            font-size: 18px;
            color: var(--cs-sub);
            margin: 0 0 16px;
        }

        /* Tabs */
        #cs-req .cs-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 8px 0 18px;
        }

        #cs-req .cs-tab {
            appearance: none;
            border: 1px solid var(--cs-line);
            background: #fff;
            padding: 10px 16px;
            border-radius: 999px;
            cursor: pointer;
            font-weight: 700;
            font-size: 18px;
            transition: .15s;
        }

        #cs-req .cs-tab:hover {
            border-color: #4169e1;
            box-shadow: 0 0 0 3px color-mix(in srgb, #4169e1 20%, transparent);
        }

        #cs-req .cs-tab.is-active {
            border-color: #4169e1;
            color: #ff0000;
            box-shadow: 0 0 0 3px rgba(0, 17, 97, .12);
        }

        /* Card */
        #cs-req .cs-card {
            background: var(--cs-bg);
            border: 1px solid var(--cs-line);
            border-radius: 16px;
            padding: 22px;
            box-shadow: 0 10px 28px rgba(2, 6, 23, .08);
        }

        /* Section chip */
        #cs-req .cs-chip {
            display: inline-block;
            background: var(--cs-chip-bg);
            color: var(--cs-chip-ink);
            border: 1px solid #e0e7ff;
            border-radius: 999px;
            padding: 6px 12px;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 10px;
        }

        /* Grid */
        #cs-req .cs-row {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 16px;
        }

        @media (max-width:820px) {
            #cs-req .cs-row {
                grid-template-columns: 1fr;
            }
        }

        /* Fields */
        #cs-req .cs-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 6px;
        }

        #cs-req .cs-label {
            font-size: 18px;
            font-weight: 700;
            color: var(--cs-ink);
        }

        #cs-req .cs-reqmark::after {
            content: " *";
            color: #e11d48;
        }

        /* Inputs */
        #cs-req .cs-input,
        #cs-req select.cs-input,
        #cs-req textarea.cs-input,
        #cs-req input[type="file"].cs-input {
            width: 100%;
            min-height: 52px;
            padding: 12px 14px;
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            background: #fff;
            color: var(--cs-ink);
            font-size: 18px;
            line-height: 1.3;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            transition: border-color .15s, box-shadow .15s;
        }

        #cs-req .cs-input::placeholder {
            color: #94a3b8;
        }

        #cs-req .cs-input:focus {
            border-color: #4169e1;
            box-shadow: 0 0 0 3px color-mix(in srgb, #4169e1 25%, transparent);
        }

        #cs-req select.cs-input {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="%23001161" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 18px 18px;
            padding-right: 48px;
            cursor: pointer;
        }

        #cs-req select.cs-input:disabled {
            background: #f8fafc;
            color: #94a3b8;
            cursor: not-allowed;
            background-image: none;
        }

        #cs-req textarea.cs-input {
            min-height: 120px;
            resize: vertical;
        }

        #cs-req input[type="file"].cs-input {
            min-height: auto;
            padding: 10px;
        }

        /* Info / terms / checks */
        #cs-req .cs-notice {
            margin: 12px 0 20px;
            padding: 14px 16px;
            border: 1px dashed var(--cs-line);
            border-radius: 12px;
            background: #f8fafc;
            font-size: 18px;
            line-height: 1.6;
        }

        #cs-req .cs-notice a {
            color: #4169e1;
            text-decoration: underline;
        }

        #cs-req .cs-terms {
            margin: 8px 0 4px 18px;
            padding: 0;
        }

        #cs-req .cs-terms li {
            margin: 8px 0;
            font-size: 18px;
            color: var(--cs-ink);
        }

        #cs-req .cs-checks {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #cs-req .cs-check {
            font-size: 18px;
            color: #0f172a;
            line-height: 1.45;
        }

        #cs-req .cs-check input {
            margin-right: 10px;
        }

        /* Separator */
        #cs-req .cs-sep {
            border: none;
            border-top: 1px dashed #e2e8f0;
            margin: 24px 0;
        }

        /* Autocomplete */
        #cs-req .ac-wrap {
            position: relative;
        }

        #cs-req .ac-list {
            position: absolute;
            left: 0;
            right: 0;
            top: calc(100% + 6px);
            z-index: 20;
            background: #fff;
            border: 1px solid var(--cs-line);
            border-radius: 12px;
            box-shadow: 0 12px 26px rgba(2, 6, 23, .10);
            max-height: 280px;
            overflow: auto;
            padding: 6px;
            display: none;
        }

        #cs-req .ac-item {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        #cs-req .ac-item:hover,
        #cs-req .ac-item[aria-selected="true"] {
            background: #f1f5ff;
        }

        #cs-req .result-left {
            display: flex;
            flex-direction: column;
        }

        #cs-req .code {
            font-weight: 700;
        }

        #cs-req .name {
            font-size: 18px;
            color: #334155;
        }

        #cs-req .pill {
            font-size: 18px;
            color: #1e3a8a;
            background: #eef2ff;
            border: 1px solid #e0e7ff;
            border-radius: 999px;
            padding: 2px 8px;
        }

        /* Toast */
        #cs-req .cs-toast {
            position: fixed;
            top: 12px;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: #111;
            color: #fff;
            padding: 8px 12px;
            border-radius: 999px;
            font-size: 16px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, .18);
            opacity: 0;
            pointer-events: none;
            transition: .18s;
            z-index: 9999;
        }

        #cs-req .cs-toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Actions / status */
        #cs-req .cs-actions {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        #cs-req .cs-btn {
            background: var(--cs-primary);
            color: var(--cs-primary-ink);
            border: none;
            border-radius: 12px;
            padding: 12px 48px;
            font-weight: 800;
            cursor: pointer;
            font-size: 18px;
        }

        #cs-req .cs-btn:hover {
            filter: brightness(1.05);
        }

        #cs-req .cs-status {
            min-height: 1.4em;
            font-size: 18px;
        }

        #cs-req .cs-ok {
            color: #16a34a;
            font-weight: 700;
        }

        #cs-req .cs-err {
            color: #b91c1c;
            font-weight: 700;
        }

        /* Kill Elementor field shadows ONLY inside our forms, keep our focus ring */
        #cs-exam input.cs-input,
        #cs-exam select.cs-input,
        #cs-exam textarea.cs-input,
        #cs-exam input[type="file"].cs-input,
        #cs-req input.cs-input,
        #cs-req select.cs-input,
        #cs-req textarea.cs-input,
        #cs-req input[type="file"].cs-input {
            box-shadow: none !important;
        }

        /* Preserve our intended focus state */
        #cs-exam input.cs-input:focus,
        #cs-exam select.cs-input:focus,
        #cs-exam textarea.cs-input:focus,
        #cs-exam input[type="file"].cs-input:focus,
        #cs-req input.cs-input:focus,
        #cs-req select.cs-input:focus,
        #cs-req textarea.cs-input:focus,
        #cs-req input[type="file"].cs-input:focus {
            box-shadow: 0 0 0 3px color-mix(in srgb, #4169e1 25%, transparent) !important;
        }
    </style>
</head>

<body>

    <div id="cs-req" class="cs-wrap">
        <div class="cs-tabs" role="tablist" aria-label="Request type">
            <button class="cs-tab is-active" data-tab="withdraw" role="tab" aria-selected="true">Withdraw from
                Course</button>
            <button class="cs-tab" data-tab="change" role="tab" aria-selected="false">Change Course</button>
            <button class="cs-tab" data-tab="mode" role="tab" aria-selected="false">Switch Mode (Online ↔
                In-Person)</button>
        </div>

        <!-- ===== WITHDRAW ===== -->
        <section id="pane-withdraw" class="cs-card" role="tabpanel">
            <span class="cs-chip">Withdrawal Request — Form Details</span>
            <p class="cs-notice">In order to withdraw, please make sure that all fees are paid to process the
                withdrawal.</p>

            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="w-fname">First Name</label>
                    <input class="cs-input" id="w-fname" name="w_fname" autocomplete="given-name" placeholder="First"
                        required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="w-lname">Last Name</label>
                    <input class="cs-input" id="w-lname" name="w_lname" autocomplete="family-name" placeholder="Last"
                        required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="w-email">Student Email</label>
                    <input class="cs-input" id="w-email" name="w_email" type="email" autocomplete="email"
                        placeholder="name@example.com" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="w-phone">Phone Number</label>
                    <input class="cs-input" id="w-phone" name="w_phone" inputmode="tel" placeholder="+1 555 555 5555"
                        required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="w-grade">Select Grade</label>
                    <select class="cs-input" id="w-grade" required></select>
                </div>
                <div class="cs-field ac-wrap">
                    <label class="cs-label cs-reqmark" for="w-coursecode">Current Course (search by code or
                        name)</label>
                    <input class="cs-input" id="w-coursecode" autocomplete="off"
                        placeholder="Start typing (e.g., MHF4U or Advanced Functions)">
                    <div id="w-ac" class="ac-list" role="listbox" aria-label="Course suggestions"></div>
                    <div class="cs-subnote">Suggestions will appear as you type.</div>
                </div>
            </div>
            <hr class="cs-sep">
            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="w-age">Are you 18 or above?</label>
                    <select class="cs-input" id="w-age" required>
                        <option value="">Select…</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="w-reason">Reason for Withdrawal</label>
                    <textarea class="cs-input" id="w-reason" rows="4" placeholder="Brief reason" required></textarea>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="w-stusig">Student Signature</label>
                    <input class="cs-input" id="w-stusig" placeholder="Type full name as signature" required>
                </div>
                <div class="cs-field" id="w-parentsig-wrap">
                    <label class="cs-label" id="w-parentsig-label" for="w-parentsig">Parent/Guardian Signature</label>
                    <input class="cs-input" id="w-parentsig" placeholder="Parent/guardian full name as signature">
                </div>
            </div>

            <hr class="cs-sep">

            <span class="cs-chip">Terms &amp; Conditions</span>
            <ul class="cs-terms">
                <li>I have read the policies and terms on the
                    <a href="https://canstemeducation.com/course-mode-change-terms-policy/" target="_blank"
                        rel="noopener">Course Mode Change &amp; Terms</a> page.
                </li>
                <li>This request is subject to approval.</li>
                <li>All fees already paid are non-refundable; I will not request a refund.</li>
                <li>To reverse a submitted request, I must submit a new request; it will be treated as a separate
                    request.</li>
            </ul>
            <div class="cs-checks">
                <label class="cs-check"><input id="w-ack" type="checkbox" required> <strong>I agree to the terms
                        above.</strong></label>
            </div>

            <hr class="cs-sep">

            <span class="cs-chip">Uploads</span>
            <div class="cs-field">
                <label class="cs-label" for="w-files">Upload Supporting Documents (optional)</label>
                <input class="cs-input" id="w-files" name="w_files" type="file" multiple>
                <div class="cs-subnote">You can select multiple files or open the picker again to add more.</div>
            </div>

            <hr class="cs-sep">
            <div class="cs-actions">
                <button class="cs-btn" onclick="submitWithdraw()">Submit</button>
                <span class="cs-status" id="w-status" aria-live="polite"></span>
            </div>
        </section>

        <!-- ===== CHANGE ===== -->
        <section id="pane-change" class="cs-card" role="tabpanel" hidden>
            <span class="cs-chip">Course Change — Form Details</span>

            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="c-fname">First Name</label>
                    <input class="cs-input" id="c-fname" placeholder="First" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="c-lname">Last Name</label>
                    <input class="cs-input" id="c-lname" placeholder="Last" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="c-email">Student Email</label>
                    <input class="cs-input" id="c-email" type="email" placeholder="name@example.com" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="c-phone">Phone Number</label>
                    <input class="cs-input" id="c-phone" inputmode="tel" placeholder="+1 555 555 5555" required>
                </div>

                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="c-grade">Current Course — Grade</label>
                    <select class="cs-input" id="c-grade" required></select>
                </div>
                <div class="cs-field ac-wrap">
                    <label class="cs-label cs-reqmark" for="c-coursecode">Current Course (search by code or
                        name)</label>
                    <input class="cs-input" id="c-coursecode" autocomplete="off"
                        placeholder="Start typing (e.g., ENG3U or English)">
                    <div id="c-ac" class="ac-list" role="listbox" aria-label="Course suggestions"></div>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="c-grade2">New Requested Course — Grade</label>
                    <select class="cs-input" id="c-grade2" required></select>
                </div>
                <div class="cs-field ac-wrap">
                    <label class="cs-label cs-reqmark" for="c-newcode">New Requested Course (search by code or
                        name)</label>
                    <input class="cs-input" id="c-newcode" autocomplete="off"
                        placeholder="Start typing (e.g., ICS4U or Computer Science)">
                    <div id="c-ac2" class="ac-list" role="listbox" aria-label="Course suggestions"></div>
                </div>
            </div>
            <hr class="cs-sep">
            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="c-age">Are you 18 or above?</label>
                    <select class="cs-input" id="c-age" required>
                        <option value="">Select…</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="c-reason">Reason for Change</label>
                    <textarea class="cs-input" id="c-reason" rows="4" placeholder="Brief reason" required></textarea>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="c-stusig">Student Signature</label>
                    <input class="cs-input" id="c-stusig" placeholder="Type full name as signature" required>
                </div>
                <div class="cs-field" id="c-parentsig-wrap">
                    <label class="cs-label" id="c-parentsig-label" for="c-parentsig">Parent/Guardian Signature</label>
                    <input class="cs-input" id="c-parentsig" placeholder="Parent/guardian full name as signature">
                </div>
            </div>

            <hr class="cs-sep">

            <span class="cs-chip">Terms &amp; Conditions</span>
            <ul class="cs-terms">
                <li>I have read the policies, fees and terms on the
                    <a href="https://canstemeducation.com/course-mode-change-terms-policy/" target="_blank"
                        rel="noopener">Course Mode Change &amp; Terms</a> page.
                </li>
                <li>This request is subject to approval.</li>
                <li>All fees are non-refundable; I will not request a refund.</li>
                <li>To reverse a submitted request, I must submit a new request; the same fees apply and it will be
                    treated as a separate request.</li>
                <li>I have completed the prerequisite for the requested course; otherwise my request will not be
                    accepted.</li>
                <li>I will submit proof of the prerequisite along with this request (see uploads below).</li>
            </ul>
            <div class="cs-checks">
                <label class="cs-check"><input id="c-ack" type="checkbox" required> <strong>I have read and agree to all
                        the terms above.</strong></label>
            </div>

            <hr class="cs-sep">

            <span class="cs-chip">Payment</span>
            <div class="cs-notice">Please complete payment here:
                <a href="https://canstemeducation.com/payment/" target="_blank"
                    rel="noopener">https://canstemeducation.com/payment/</a>
            </div>
            <div class="cs-checks">
                <label class="cs-check"><input id="c-paid" type="checkbox"> <strong>I made the payment and understand
                        processing starts after verification.</strong></label>
            </div>

            <hr class="cs-sep">

            <span class="cs-chip">Uploads</span>
            <div class="cs-field">
                <label class="cs-label" for="c-up-payment">Proof of Payment</label>
                <input class="cs-input" id="c-up-payment" name="c_up_payment" type="file" multiple>
            </div>
            <div class="cs-field">
                <label class="cs-label" for="c-prereq">Proof of Prerequisite Subject(s)</label>
                <input class="cs-input" id="c-prereq" name="c_prereq" type="file" multiple>
            </div>
            <div class="cs-field">
                <label class="cs-label" for="c-files">Upload Supporting Documents</label>
                <input class="cs-input" id="c-files" name="c_files" type="file" multiple>
            </div>

            <hr class="cs-sep">
            <div class="cs-actions">
                <button class="cs-btn" onclick="submitChange()">Submit</button>
                <span class="cs-status" id="c-status" aria-live="polite"></span>
            </div>
        </section>

        <!-- ===== MODE ===== -->
        <section id="pane-mode" class="cs-card" role="tabpanel" hidden>
            <span class="cs-chip">Course Mode Switch — Form Details</span>

            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-fname">First Name</label>
                    <input class="cs-input" id="m-fname" placeholder="First" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-lname">Last Name</label>
                    <input class="cs-input" id="m-lname" placeholder="Last" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-email">Student Email</label>
                    <input class="cs-input" id="m-email" type="email" placeholder="name@example.com" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-phone">Phone Number</label>
                    <input class="cs-input" id="m-phone" inputmode="tel" placeholder="+1 555 555 5555" required>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-grade">Select Grade</label>
                    <select class="cs-input" id="m-grade" required></select>
                </div>
                <div class="cs-field ac-wrap">
                    <label class="cs-label cs-reqmark" for="m-coursecode">Current Course (search by code or
                        name)</label>
                    <input class="cs-input" id="m-coursecode" autocomplete="off"
                        placeholder="Start typing (e.g., MDM4U or Data Management)">
                    <div id="m-ac" class="ac-list" role="listbox" aria-label="Course suggestions"></div>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-currentmode">Current Mode</label>
                    <select class="cs-input" id="m-currentmode" required>
                        <option value="">Select current mode…</option>
                        <option>Online</option>
                        <option>In-Person</option>
                    </select>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-mode">Requested Mode</label>
                    <select class="cs-input" id="m-mode" required>
                        <option value="">Select requested mode…</option>
                        <option>Online</option>
                        <option>In-Person</option>
                    </select>
                </div>
            </div>
            <hr class="cs-sep">
            <div class="cs-row">
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-age">Are you 18 or above?</label>
                    <select class="cs-input" id="m-age" required>
                        <option value="">Select…</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-reason">Reason for Mode Switch</label>
                    <textarea class="cs-input" id="m-reason" rows="4" placeholder="Brief reason" required></textarea>
                </div>
                <div class="cs-field">
                    <label class="cs-label cs-reqmark" for="m-stusig">Student Signature</label>
                    <input class="cs-input" id="m-stusig" placeholder="Type full name as signature" required>
                </div>
                <div class="cs-field" id="m-parentsig-wrap">
                    <label class="cs-label" id="m-parentsig-label" for="m-parentsig">Parent/Guardian Signature</label>
                    <input class="cs-input" id="m-parentsig" placeholder="Parent/guardian full name as signature">
                </div>
            </div>

            <hr class="cs-sep">

            <span class="cs-chip">Terms &amp; Conditions</span>
            <ul class="cs-terms">
                <li>I have read the policies, fees and terms on the
                    <a href="https://canstemeducation.com/course-mode-change-terms-policy/" target="_blank"
                        rel="noopener">Course Mode Change &amp; Terms</a> page.
                </li>
                <li>This request is subject to approval.</li>
                <li>All fees are non-refundable; I will not request a refund.</li>
                <li>To reverse a submitted request, I must submit a new request; the same fees apply and it will be
                    treated as a separate request.</li>
            </ul>
            <div class="cs-checks">
                <label class="cs-check"><input id="m-ack" type="checkbox" required> <strong>I have read and agree to all
                        the terms above.</strong></label>
            </div>

            <hr class="cs-sep">

            <span class="cs-chip">Payment</span>
            <div class="cs-notice">Please complete payment here:
                <a href="https://canstemeducation.com/payment/" target="_blank"
                    rel="noopener">https://canstemeducation.com/payment/</a>
            </div>
            <div class="cs-checks">
                <label class="cs-check"><input id="m-paid" type="checkbox"> <strong>I made the payment and understand
                        processing starts after verification.</strong></label>
            </div>

            <hr class="cs-sep">

            <span class="cs-chip">Uploads</span>
            <div class="cs-field">
                <label class="cs-label" for="m-up-payment">Proof of Payment</label>
                <input class="cs-input" id="m-up-payment" name="m_up_payment" type="file" multiple>
            </div>
            <div class="cs-field">
                <label class="cs-label" for="m-files">Upload Supporting Documents</label>
                <input class="cs-input" id="m-files" name="m_files" type="file" multiple>
            </div>

            <hr class="cs-sep">
            <div class="cs-actions">
                <button class="cs-btn" onclick="submitMode()">Submit</button>
                <span class="cs-status" id="m-status" aria-live="polite"></span>
            </div>
        </section>
    </div>

    <div id="toast" class="cs-toast" role="status" aria-live="polite"></div>

    <script>
        (function () {
            const WEB_APP_URL = '/wp-admin/admin-ajax.php?action=canstem_change_request';

            /* ===== Datasets (codes + names by grade) ===== */
            const D9 = [{ code: "AVI1O", name: "Visual Arts" }, { code: "ADA1O", name: "Drama" }, { code: "BEM1O", name: "Building The Entrepreneurial Mindset" }, { code: "CGC1W", name: "Issues in Canadian Geography (De-Streamed)" }, { code: "ENL1W", name: "English (De-Streamed)" }, { code: "EAE1W", name: "English (French OSSD), De-Streamed" }, { code: "ENG1L", name: "English (LDCC)" }, { code: "FSF1D", name: "French (De-Streamed)" }, { code: "FSF1O", name: "Core French (Open)" }, { code: "GLS1O", name: "Learning Strategies 1: Skills for Success" }, { code: "GLE1O", name: "Learning Strategies 1: Skills for Success" }, { code: "HFN1O", name: "Food and Nutrition" }, { code: "HIF1O", name: "Exploring Family Studies" }, { code: "PPL1O", name: "Healthy Active Living Education" }, { code: "MTH1W", name: "Mathematics (De-Streamed)" }, { code: "MAT1L", name: "Mathematics (LDCC)" }, { code: "SNC1W", name: "Science (De-Streamed)" }, { code: "SNC1L", name: "Science (LDCC)" }, { code: "TIJ1O", name: "Exploring Technologies" }, { code: "TAS1O", name: "Technology and the Skilled Trades" }, { code: "NONE", name: "Not in the list" }];
            const D10 = [{ code: "AVI2O", name: "Visual Arts (G10)" }, { code: "ADA2O", name: "Drama (G10)" }, { code: "ASM2O", name: "Media Arts (G10)" }, { code: "BEP2O", name: "Launching and Leading a Business (G10)" }, { code: "CHC2D", name: "Canadian History Since WWI (Academic)" }, { code: "CHC2P", name: "Canadian History Since WWI (Applied)" }, { code: "CHV2O", name: "Civics and Citizenship" }, { code: "ENG2D", name: "English (Academic)" }, { code: "ENG2P", name: "English (Applied)" }, { code: "ENG2L", name: "English (LDCC)" }, { code: "EAE2D", name: "English (French OSSD, Academic)" }, { code: "FSF2D", name: "French (Academic)" }, { code: "FSF2O", name: "Core French (Open)" }, { code: "FSF2P", name: "Core French (Applied)" }, { code: "GLC2O", name: "Career Studies" }, { code: "HIF2O", name: "Individual and Family Living" }, { code: "HFN2O", name: "Food and Nutrition (G10)" }, { code: "ICS2O", name: "Introduction to Computer Studies" }, { code: "ICD2O", name: "Digital Technology & Innovations" }, { code: "MPM2D", name: "Principles of Mathematics (Academic)" }, { code: "MFM2P", name: "Foundations of Mathematics (Applied)" }, { code: "MAT2L", name: "Mathematics (LDCC)" }, { code: "PPL2O", name: "Healthy Active Living Education (G10)" }, { code: "SNC2D", name: "Science (Academic)" }, { code: "SNC2P", name: "Science (Applied)" }, { code: "SNC2L", name: "Science (LDCC)" }, { code: "RGJ2O", name: "Communications Technology (G10)" }, { code: "TEJ2O", name: "Computer Technology (G10)" }, { code: "TFJ2O", name: "Hospitality and Tourism (G10)" }, { code: "TDJ2O", name: "Technological Design (G10)" }, { code: "TAS2O", name: "Technology and the Skilled Trades (G10)" }, { code: "NONE", name: "Not in the list" }];
            const D11 = [{ code: "AVI3M", name: "Visual Arts (U/C)" }, { code: "AVI3O", name: "Visual Arts (Open)" }, { code: "ADA3M", name: "Drama (U/C)" }, { code: "ADA3O", name: "Drama (Open)" }, { code: "ASM3M", name: "Media Arts (U/C)" }, { code: "ASM3O", name: "Media Arts (Open)" }, { code: "BAF3M", name: "Financial Accounting Fundamentals" }, { code: "BAI3E", name: "Accounting Essentials (Workplace)" }, { code: "BDI3C", name: "Entrepreneurship: The Venture" }, { code: "BDP3O", name: "Entrepreneurship: The Enterprising Person" }, { code: "BTA3O", name: "ICT: The Digital Environment" }, { code: "BMI3C", name: "Marketing: Goods, Services, Events" }, { code: "CIE3M", name: "The Individual and the Economy" }, { code: "CGD3M", name: "Regional Geography" }, { code: "CGF3M", name: "Forces of Nature" }, { code: "CGT3O", name: "Intro to Spatial Technologies (Open)" }, { code: "CGG3O", name: "Travel & Tourism" }, { code: "CHA3U", name: "American History" }, { code: "CHW3U", name: "World History to 15th Century" }, { code: "CHT3O", name: "World History since 1900 (Open)" }, { code: "CLU3M", name: "Understanding Canadian Law" }, { code: "CPC3O", name: "Politics in Action: Making Change" }, { code: "ENG3C", name: "English (College)" }, { code: "ENG3U", name: "English (University)" }, { code: "ENG3E", name: "English (Workplace)" }, { code: "EAE3U", name: "English (French OSSD, University)" }, { code: "EPS3O", name: "Presentation and Speaking Skills" }, { code: "EMS3O", name: "Media Studies (Open)" }, { code: "FSF3U", name: "Core French (University)" }, { code: "FSF3O", name: "Core French (Open)" }, { code: "FEF3U", name: "Extended French (University)" }, { code: "FIF3U", name: "French Immersion (University)" }, { code: "FIF3O", name: "French Immersion (Open)" }, { code: "GWL3O", name: "Designing Your Future" }, { code: "HSG3M", name: "Gender Studies" }, { code: "HSE3E", name: "Equity & Social Justice (Workplace)" }, { code: "HFC3M", name: "Food and Culture" }, { code: "HPW3C", name: "Working with Infants & Young Children" }, { code: "HZB3M", name: "Philosophy: The Big Questions" }, { code: "HRT3M", name: "World Religions" }, { code: "HPC3O", name: "Raising Healthy Children" }, { code: "HSP3U", name: "Intro to Anthropology (University)" }, { code: "HSP3C", name: "Anthro/Psych/Soc (College)" }, { code: "ICS3C", name: "Intro to Computer Programming (College)" }, { code: "ICS3U", name: "Intro to Computer Science (University)" }, { code: "IDC3O", name: "Sports & Entertainment Marketing (Open)" }, { code: "MBF3C", name: "Foundations for College Mathematics" }, { code: "MCF3M", name: "Functions and Applications" }, { code: "MCR3U", name: "Functions" }, { code: "MEL3E", name: "Math for Work & Everyday Life (Workplace)" }, { code: "PPL3O", name: "Healthy Active Living Education" }, { code: "PPZ3C", name: "Health for Life" }, { code: "SBI3C", name: "Biology (College)" }, { code: "SBI3U", name: "Biology (University)" }, { code: "SCH3U", name: "Chemistry (University)" }, { code: "SPH3U", name: "Physics (University)" }, { code: "SVN3M", name: "Environmental Science (U/C)" }, { code: "SVN3E", name: "Environmental Science (Workplace)" }, { code: "TEI3M", name: "Computer Eng. Tech: Interfacing (U/C)" }, { code: "TEJ3M", name: "Computer Engineering Technology (U/C)" }, { code: "TEL3M", name: "Computer Eng. Tech: Electronics (U/C)" }, { code: "TEN3M", name: "Computer Eng. Tech: Networking (U/C)" }, { code: "TET3E", name: "Computer Technology: IT Support" }, { code: "TEW3E", name: "Computer Technology: Network Support" }, { code: "TGJ3M", name: "Communications Technology (U/C)" }, { code: "TFE3E", name: "Hospitality & Tourism: Event Planning (W)" }, { code: "TFJ3E", name: "Hospitality & Tourism (Workplace)" }, { code: "TFJC", name: "Hospitality & Tourism (College)" }, { code: "TDJ3M", name: "Technological Design (U/C)" }, { code: "TGJ3O", name: "Communications Tech: Broadcast/Print" }, { code: "TDJ3O", name: "Technological Design and the Environment" }, { code: "TGI3M", name: "Interactive New Media & Animation (U/C)" }, { code: "TGP3M", name: "Photography & Digital Imaging (U/C)" }, { code: "TPD3M", name: "Health Care: Dental Services (U/C)" }, { code: "TPL3M", name: "Health Care: Laboratory Services (U/C)" }, { code: "TPM3M", name: "Health Care: Nursing/Medical Services (U/C)" }, { code: "TPP3M", name: "Health Services: Pharmacy (U/C)" }, { code: "TPT3M", name: "Health Care: Therapy Services (U/C)" }, { code: "TPJ3C", name: "Health Care (College)" }, { code: "TPJ3M", name: "Health Care (U/C)" }, { code: "NONE", name: "Not in the list" }];
            const D12 = [{ code: "ADA4E", name: "Drama (Workplace)" }, { code: "ADA4M", name: "Drama (U/C)" }, { code: "AEA4O", name: "Exploring & Creating in the Arts" }, { code: "ASM4M", name: "Media Arts (U/C)" }, { code: "ASM4E", name: "Media Arts (Workplace)" }, { code: "AVI4M", name: "Visual Arts (U/C)" }, { code: "BAT4M", name: "Financial Accounting Principles" }, { code: "BDV4C", name: "Entrepreneurship: Venture Planning (C)" }, { code: "BTX4C", name: "ICT: Multimedia Solutions (C)" }, { code: "BBB4M", name: "International Business Fundamentals" }, { code: "BOH4M", name: "Business Leadership" }, { code: "CIA4U", name: "Analysing Current Economic Issues" }, { code: "CGW4U", name: "World Issues (University)" }, { code: "CGW4C", name: "World Issues (College)" }, { code: "CGR4M", name: "Environment & Resource Management" }, { code: "CGO4M", name: "Spatial Technologies in Action" }, { code: "CGU4M", name: "World Geography: Urban Patterns" }, { code: "CHY4U", name: "World History since 15th Century (U)" }, { code: "CHY4C", name: "World History since 15th Century (C)" }, { code: "CHI4U", name: "Canada: History, Identity & Culture" }, { code: "CLN4U", name: "Canadian & International Law (U)" }, { code: "CLN4C", name: "Legal Studies (College)" }, { code: "CPW4U", name: "Canadian & International Politics" }, { code: "ENG4U", name: "English (University)" }, { code: "ENG4C", name: "English (College)" }, { code: "ENG4E", name: "English (Workplace)" }, { code: "EAE4U", name: "English (French OSSD, University)" }, { code: "EWC4U", name: "The Writer’s Craft (University)" }, { code: "EWC4C", name: "The Writer’s Craft (College)" }, { code: "FSF4U", name: "Core French (University)" }, { code: "FSF4O", name: "Core French (Open)" }, { code: "HSE4M", name: "Equity & Social Justice" }, { code: "HSC4M", name: "World Cultures" }, { code: "HFA4U", name: "Nutrition & Health (University)" }, { code: "HFA4C", name: "Nutrition & Health (College)" }, { code: "HHS4U", name: "Families in Canada (University)" }, { code: "HHS4C", name: "Families in Canada (College)" }, { code: "HHG4M", name: "Human Development Through the Life Span" }, { code: "HIP4O", name: "Personal Life Management" }, { code: "HPD4C", name: "Working with School-Age Children & Adolescents" }, { code: "HSB4U", name: "Challenge & Change in Society" }, { code: "HZT4U", name: "Philosophy: Questions & Theories" }, { code: "ICS4U", name: "Computer Science (University)" }, { code: "ICS4C", name: "Computer Programming (College)" }, { code: "IDC4U", name: "Sports & Entertainment Marketing (U)" }, { code: "IDC4O", name: "Sports & Entertainment Marketing (Open)" }, { code: "MHF4U", name: "Advanced Functions" }, { code: "MCV4U", name: "Calculus and Vectors" }, { code: "MDM4U", name: "Mathematics of Data Management" }, { code: "MCT4C", name: "Mathematics for College Technology" }, { code: "MAP4C", name: "Foundations for College Mathematics" }, { code: "MEL4E", name: "Math for Work & Everyday Life (Workplace)" }, { code: "OLC4O", name: "Ontario Secondary School Literacy Course" }, { code: "PPL4O", name: "Healthy Active Living Education" }, { code: "PLF4M", name: "Recreation & Healthy Active Living Leadership" }, { code: "PSK4U", name: "Introductory Kinesiology" }, { code: "SBI4U", name: "Biology (University)" }, { code: "SCH4C", name: "Chemistry (College)" }, { code: "SCH4U", name: "Chemistry (University)" }, { code: "SPH4U", name: "Physics (University)" }, { code: "SES4U", name: "Earth and Space Science" }, { code: "SNC4M", name: "Science (U/C)" }, { code: "SNC4E", name: "Science (Workplace)" }, { code: "TGJ4M", name: "Communications Technology (U/C)" }, { code: "TGJ4O", name: "Communications Tech: Digital Imagery & Web" }, { code: "TEJ4M", name: "Computer Engineering Technology (U/C)" }, { code: "TFJ4E", name: "Hospitality & Tourism (Workplace)" }, { code: "TFJ4C", name: "Hospitality & Tourism (College)" }, { code: "TDJ4M", name: "Technological Design (U/C)" }, { code: "TDJ4O", name: "Technological Design in the 21st Century" }, { code: "TEI4M", name: "Computer Eng. Tech: Interfacing (U/C)" }, { code: "TEN4M", name: "Computer Eng. Tech: Networking" }, { code: "TET4E", name: "Computer Technology: IT Support" }, { code: "TEW4E", name: "Computer Technology: Network Support" }, { code: "TGI4M", name: "Interactive New Media & Animation" }, { code: "TGP4M", name: "Photography & Digital Imaging" }, { code: "TOC4C", name: "Child Development" }, { code: "TOG4C", name: "Gerontology" }, { code: "TPD4M", name: "Health Care: Dental Services" }, { code: "TPL4M", name: "Health Care: Laboratory Services" }, { code: "TPM4M", name: "Health Care: Nursing/Medical Services" }, { code: "TPP4M", name: "Health Services: Pharmacy" }, { code: "TPT4M", name: "Health Care: Therapy Services" }, { code: "TPJ4C", name: "Health Care (College)" }, { code: "TPJ4E", name: "Health Care (Workplace)" }, { code: "TPJ4M", name: "Health Care (U/C)" }, { code: "NONE", name: "Not in the list" }];
            const DESL = [{ code: "NONE", name: "Not in the list" }, { code: "ESLAO", name: "ESL Level 1" }, { code: "ESLBO", name: "ESL Level 2" }, { code: "ESLCO", name: "ESL Level 3" }, { code: "ESLDO", name: "ESL Level 4" }, { code: "ESLEO", name: "ESL Level 5" }, { code: "ELDAO", name: "ELD Level 1" }, { code: "ELDBO", name: "ELD Level 2" }, { code: "ELDCO", name: "ELD Level 3" }, { code: "ELDDO", name: "ELD Level 4" }, { code: "ELDEO", name: "ELD Level 5" }];

            const GRADES = ["Select grade…", "Grade 9", "Grade 10", "Grade 11", "Grade 12", "ESL/ELD Courses"];
            const listFor = g => ({ "Grade 9": D9, "Grade 10": D10, "Grade 11": D11, "Grade 12": D12, "ESL/ELD Courses": DESL }[g] || []);
            const codesFor = g => listFor(g).map(x => x.code);
            const nameFor = (g, c) => { const f = listFor(g).find(x => x.code === c); return f ? f.name : ""; };

            /* Tabs */
            document.querySelector('#cs-req .cs-tabs').addEventListener('click', e => {
                if (!e.target.classList.contains('cs-tab')) return;
                document.querySelectorAll('#cs-req .cs-tab').forEach(b => { b.classList.remove('is-active'); b.setAttribute('aria-selected', 'false'); });
                e.target.classList.add('is-active'); e.target.setAttribute('aria-selected', 'true');
                const tab = e.target.dataset.tab;
                document.querySelectorAll('#cs-req [role="tabpanel"]').forEach(p => p.hidden = true);
                document.getElementById('pane-' + tab).hidden = false;
            });

            /* Helpers */
            const val = id => (document.getElementById(id)?.value || '').trim();
            function toast(msg) { const el = document.getElementById('toast'); el.textContent = msg; el.classList.add('show'); clearTimeout(el._t); el._t = setTimeout(() => el.classList.remove('show'), 1500); }

            function populateGrade(id) {
                const s = document.getElementById(id); if (s.dataset.ready) return;
                GRADES.forEach(g => s.appendChild(new Option(g, g)));
                s.value = GRADES[0]; s.dataset.ready = "1";
            }

            function attachAutocomplete(inputId, listId, gradeSelId) {
                const input = document.getElementById(inputId), list = document.getElementById(listId), gradeSel = document.getElementById(gradeSelId);
                let active = -1;
                function hide() { list.style.display = 'none'; }
                function render() {
                    const q = input.value.trim().toUpperCase();
                    const data = listFor(gradeSel.value);
                    const items = !q ? data.slice(0, 24) : data.filter(({ code, name }) => (code + " " + name).toUpperCase().includes(q)).slice(0, 24);
                    list.innerHTML = '';
                    items.forEach((it, idx) => {
                        const div = document.createElement('div'); div.className = 'ac-item'; div.role = 'option'; div.id = listId + '-' + idx;
                        div.innerHTML = `<div class="result-left"><span class="code">${it.code}</span><span class="name">${it.name}</span></div><span class="pill">${gradeSel.value}</span>`;
                        div.addEventListener('click', () => { input.value = it.code; hide(); });
                        list.appendChild(div);
                    });
                    list.style.display = items.length ? 'block' : 'none'; active = -1;
                }
                input.addEventListener('input', render);
                input.addEventListener('focus', render);
                input.addEventListener('blur', () => setTimeout(hide, 150));
                gradeSel.addEventListener('change', render);
                input.addEventListener('keydown', e => {
                    const items = [...list.querySelectorAll('.ac-item')]; if (!items.length) return;
                    if (e.key === 'ArrowDown') { e.preventDefault(); active = Math.min(active + 1, items.length - 1); }
                    else if (e.key === 'ArrowUp') { e.preventDefault(); active = Math.max(active - 1, 0); }
                    else if (e.key === 'Enter') { if (active >= 0) { e.preventDefault(); items[active].click(); } }
                    else if (e.key === 'Escape') { hide(); }
                    items.forEach(i => i.setAttribute('aria-selected', 'false'));
                    if (active >= 0) { items[active].setAttribute('aria-selected', 'true'); items[active].scrollIntoView({ block: 'nearest' }); }
                });
            }

            function wireDisableFor(inputId, gradeSelId) {
                const input = document.getElementById(inputId), grade = document.getElementById(gradeSelId);
                const setState = () => { const need = !(grade && grade.value && grade.value !== GRADES[0]); input.disabled = need; };
                setState(); grade.addEventListener('change', setState);
                ['mousedown', 'mouseenter', 'touchstart', 'focus'].forEach(ev => {
                    input.addEventListener(ev, (e) => { if (input.disabled) { e.preventDefault(); input.blur(); } }, { passive: false });
                });
            }

            function setupAgeGate(prefix) {
                const sel = document.getElementById(`${prefix}-age`),
                    wrap = document.getElementById(`${prefix}-parentsig-wrap`),
                    input = document.getElementById(`${prefix}-parentsig`),
                    label = document.getElementById(`${prefix}-parentsig-label`);
                const update = () => { const isAdult = sel.value === 'yes'; if (isAdult) { input.required = false; wrap.style.display = 'none'; } else { wrap.style.display = ''; input.required = true; label.classList.add('cs-reqmark'); } };
                update(); sel.addEventListener('change', update);
            }

            const validateCourseCode = (grade, code) => codesFor(grade).includes(code);

            function isValid(paneId) {
                const pane = document.getElementById(paneId), req = pane.querySelectorAll('[required]');
                for (const el of req) {
                    if (el.type === 'checkbox' && !el.checked) { el.focus(); return false; }
                    if (!el.value || (el.tagName === 'SELECT' && !el.value)) { el.focus(); return false; }
                }
                return true;
            }

            function setStatus(id, msg, ok) {
                const el = document.getElementById(id);
                el.className = 'cs-status';
                el.textContent = msg;
                if (ok === true) el.classList.add('cs-ok');
                if (ok === false) el.classList.add('cs-err');
            }

            /* Build FormData and add files under PHP-expected names */
            function appendFiles(fd, inputId, fieldName) {
                const el = document.getElementById(inputId);
                if (!el || !el.files) return;
                for (const f of el.files) fd.append(fieldName, f, f.name);
            }

            async function sendFields(fields, fileMap, statusId, paneId) {
                setStatus(statusId, 'Submitting…', null);
                try {
                    const fd = new FormData();
                    Object.entries(fields).forEach(([k, v]) => fd.append(k, v));
                    fileMap.forEach(({ inputId, fieldName }) => appendFiles(fd, inputId, fieldName));

                    const resp = await fetch(WEB_APP_URL, { method: 'POST', body: fd, credentials: 'same-origin' });
                    const data = await resp.json().catch(() => ({ ok: false, error: 'Invalid server response' }));
                    if (resp.ok && data.ok) {
                        setStatus(statusId, 'Success! Your request has been emailed to the front desk.', true);
                        const pane = document.getElementById(paneId);
                        pane.querySelectorAll('input,textarea,select').forEach(x => {
                            if (x.type === 'file') x.value = '';
                            else if (x.type === 'checkbox') x.checked = false;
                            else x.value = '';
                        });
                        initAll();
                    } else {
                        setStatus(statusId, data.error || 'Error sending your request. Please try again.', false);
                    }
                } catch {
                    setStatus(statusId, 'Network error. Please try again.', false);
                }
            }

            /* Submit handlers */
            window.submitWithdraw = async function () {
                if (!isValid('pane-withdraw')) return;
                const grade = val('w-grade'), code = val('w-coursecode');
                if (!validateCourseCode(grade, code)) { alert('Please choose a valid course code for the selected grade.'); return; }
                const fullName = `${val('w-fname')} ${val('w-lname')}`.trim();

                await sendFields({
                    type: 'Withdrawal',
                    name: fullName,
                    firstName: val('w-fname'),
                    lastName: val('w-lname'),
                    email: val('w-email'),
                    phone: val('w-phone'),
                    grade,
                    courseCode: code,
                    studentSig: val('w-stusig'),
                    parentSig: val('w-parentsig'),
                    reason: val('w-reason'),
                    acceptTerms: document.getElementById('w-ack').checked ? 'Yes' : 'No'
                }, [
                    { inputId: 'w-files', fieldName: 'w_files' }
                ], 'w-status', 'pane-withdraw');
            };

            window.submitChange = async function () {
                if (!isValid('pane-change')) return;
                const gradeCur = val('c-grade'), codeCur = val('c-coursecode');
                const gradeNew = val('c-grade2'), codeNew = val('c-newcode');
                if (!validateCourseCode(gradeCur, codeCur)) { alert('Please pick a valid current course for the selected grade.'); return; }
                if (!validateCourseCode(gradeNew, codeNew)) { alert('Please pick a valid NEW course for the selected grade.'); return; }
                const fullName = `${val('c-fname')} ${val('c-lname')}`.trim();

                await sendFields({
                    type: 'Change Course',
                    name: fullName,
                    firstName: val('c-fname'),
                    lastName: val('c-lname'),
                    email: val('c-email'),
                    phone: val('c-phone'),
                    grade: gradeCur,
                    courseCode: codeCur,
                    newcourse: `${codeNew} – ${nameFor(gradeNew, codeNew)}`,
                    studentSig: val('c-stusig'),
                    parentSig: val('c-parentsig'),
                    reason: val('c-reason'),
                    paidConfirmed: document.getElementById('c-paid').checked ? 'Yes' : 'No',
                    acceptTerms: document.getElementById('c-ack').checked ? 'Yes' : 'No'
                }, [
                    { inputId: 'c-up-payment', fieldName: 'c_up_payment' },
                    { inputId: 'c-prereq', fieldName: 'c_prereq' },
                    { inputId: 'c-files', fieldName: 'c_files' }
                ], 'c-status', 'pane-change');
            };

            window.submitMode = async function () {
                if (!isValid('pane-mode')) return;
                const grade = val('m-grade'), code = val('m-coursecode');
                if (!validateCourseCode(grade, code)) { alert('Please choose a valid course code for the selected grade.'); return; }
                const fullName = `${val('m-fname')} ${val('m-lname')}`.trim();

                await sendFields({
                    type: 'Mode Switch',
                    name: fullName,
                    firstName: val('m-fname'),
                    lastName: val('m-lname'),
                    email: val('m-email'),
                    phone: val('m-phone'),
                    grade,
                    courseCode: code,
                    currentMode: val('m-currentmode'),
                    mode: val('m-mode'),
                    studentSig: val('m-stusig'),
                    parentSig: val('m-parentsig'),
                    reason: val('m-reason'),
                    paidConfirmed: document.getElementById('m-paid').checked ? 'Yes' : 'No',
                    acceptTerms: document.getElementById('m-ack').checked ? 'Yes' : 'No'
                }, [
                    { inputId: 'm-up-payment', fieldName: 'm_up_payment' },
                    { inputId: 'm-files', fieldName: 'm_files' }
                ], 'm-status', 'pane-mode');
            };

            /* Init */
            function initAll() {
                ['w-grade', 'c-grade', 'c-grade2', 'm-grade'].forEach(populateGrade);
                attachAutocomplete('w-coursecode', 'w-ac', 'w-grade');
                attachAutocomplete('c-coursecode', 'c-ac', 'c-grade');
                attachAutocomplete('c-newcode', 'c-ac2', 'c-grade2');
                attachAutocomplete('m-coursecode', 'm-ac', 'm-grade');

                wireDisableFor('w-coursecode', 'w-grade');
                wireDisableFor('c-coursecode', 'c-grade');
                wireDisableFor('c-newcode', 'c-grade2');
                wireDisableFor('m-coursecode', 'm-grade');

                setupAgeGate('w'); setupAgeGate('c'); setupAgeGate('m');
            }
            window.addEventListener('DOMContentLoaded', initAll);
        })();
    </script>
</body>

</html>