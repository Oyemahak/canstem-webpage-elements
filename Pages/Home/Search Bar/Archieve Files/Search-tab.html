<!-- ================== CanSTEM Elegant Search - RIGHT FILTER (csea) ================== -->
<section id="canstem-smart-search" class="csea-wrap" aria-label="Search CanSTEM Courses">
    <div class="csea-bar" role="combobox" aria-expanded="false" aria-owns="csea-results" aria-haspopup="listbox">
        <!-- magnifier -->
        <svg class="csea-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" />
        </svg>

        <!-- query -->
        <input id="csea-input" class="csea-input" type="search" placeholder="Search courses by code or name…"
            autocomplete="off" aria-autocomplete="list" aria-controls="csea-results" />

        <!-- clear -->
        <button id="csea-clear" type="button" class="csea-clear" aria-label="Clear search" title="Clear">✕</button>

        <!-- RIGHT: custom filter (button + animated menu) -->
        <div class="csea-filter" data-open="false">
            <button id="csea-filter-btn" type="button" class="csea-filter-btn" aria-haspopup="true"
                aria-expanded="false">
                <span id="csea-filter-label">All</span>
                <svg class="csea-caret" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
            </button>
            <div id="csea-filter-menu" class="csea-filter-menu" role="menu" aria-label="Filter by grade">
                <button class="csea-menu-item" data-grade="ALL" role="menuitem">All</button>
                <button class="csea-menu-item" data-grade="Grade 9" role="menuitem">Grade 9</button>
                <button class="csea-menu-item" data-grade="Grade 10" role="menuitem">Grade 10</button>
                <button class="csea-menu-item" data-grade="Grade 11" role="menuitem">Grade 11</button>
                <button class="csea-menu-item" data-grade="Grade 12" role="menuitem">Grade 12</button>
                <button class="csea-menu-item" data-grade="ESL/ELD Courses" role="menuitem">ESL &amp; ELD</button>
            </div>
        </div>
    </div>

    <!-- results -->
    <div id="csea-results" class="csea-results" role="listbox" aria-label="Course results"></div>
</section>

<style>
    /* --------- fully scoped design (csea-*) --------- */
    .csea-wrap {
        --csea-accent: #FBB025;
        --csea-ring: rgba(251, 176, 37, .2);
        --csea-ring-strong: rgba(251, 176, 37, .32);
        max-width: 1200px;
        margin: 0 auto;
        position: relative
    }

    .csea-bar {
        position: relative;
        display: grid;
        grid-template-columns: 22px 1fr auto auto;
        align-items: center;
        gap: 14px;
        background: #fff;
        border-radius: 999px;
        padding: 16px 16px;
        border: 1px solid rgba(251, 176, 37, .38);
        box-shadow: 0 14px 34px rgba(2, 6, 23, .10), 0 0 0 6px var(--csea-ring);
        transition: border-color .15s, box-shadow .15s, transform .05s;
    }

    .csea-bar:focus-within {
        border-color: rgba(251, 176, 37, .62);
        box-shadow: 0 18px 46px rgba(2, 6, 23, .16), 0 0 0 9px var(--csea-ring-strong)
    }

    .csea-icon {
        width: 22px;
        height: 22px;
        color: #64748b;
        flex: 0 0 auto
    }

    .csea-input {
        border: 0;
        outline: none;
        background: transparent;
        width: 100%;
        font: 500 18px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial;
        color: #0f172a;
        min-width: 140px
    }

    .csea-input::placeholder {
        color: #94a3b8
    }

    .csea-clear {
        display: none;
        border: 0;
        background: transparent;
        color: #64748b;
        cursor: pointer;
        font-size: 20px;
        line-height: 1;
        padding: 4px;
        border-radius: 8px
    }

    .csea-clear:hover {
        background: #f1f5f9
    }

    /* RIGHT filter button */
    .csea-filter {
        position: relative
    }

    .csea-filter-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 14px;
        background: #fff7ed;
        border: 1px solid rgba(251, 176, 37, .5);
        border-radius: 999px;
        font: 700 14px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial;
        color: #0f172a;
        cursor: pointer;
        box-shadow: inset 0 0 0 1px rgba(251, 176, 37, .06), 0 2px 6px rgba(2, 6, 23, .04);
        transition: box-shadow .15s, transform .05s
    }

    .csea-filter-btn:hover {
        box-shadow: inset 0 0 0 1px rgba(251, 176, 37, .16), 0 4px 12px rgba(2, 6, 23, .08)
    }

    .csea-filter-btn:focus {
        outline: none;
        box-shadow: inset 0 0 0 1px rgba(251, 176, 37, .22), 0 0 0 6px var(--csea-ring)
    }

    .csea-caret {
        width: 16px;
        height: 16px;
        color: #0f172a;
        transition: transform .18s
    }

    .csea-filter[data-open="true"] .csea-caret {
        transform: rotate(180deg)
    }

    /* animated custom menu */
    .csea-filter-menu {
        position: absolute;
        right: 0;
        top: calc(100% + 10px);
        min-width: 180px;
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 14px;
        box-shadow: 0 24px 60px rgba(2, 6, 23, .18), 0 2px 0 rgba(2, 6, 23, .02);
        padding: 6px;
        z-index: 60;
        transform-origin: top right;
        opacity: 0;
        transform: scale(.98) translateY(-6px);
        pointer-events: none;
        transition: opacity .16s ease, transform .16s ease;
    }

    .csea-filter[data-open="true"] .csea-filter-menu {
        opacity: 1;
        transform: scale(1) translateY(0);
        pointer-events: auto
    }

    .csea-menu-item {
        width: 100%;
        text-align: left;
        border: 0;
        background: #fff;
        border-radius: 10px;
        cursor: pointer;
        padding: 10px 12px;
        font: 600 18px/1.25 system-ui, -apple-system, Segoe UI, Roboto, Arial;
        color: #0f172a
    }

    .csea-menu-item:hover {
        background: #f8fafc
    }

    /* results dropdown */
    .csea-results {
        display: none;
        position: absolute;
        left: 0;
        right: 0;
        top: calc(100% + 12px);
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        box-shadow: 0 24px 60px rgba(2, 6, 23, .18);
        max-height: 440px;
        overflow: auto;
        z-index: 50;
        transform-origin: top;
        opacity: 0;
        transform: translateY(-6px);
        transition: opacity .16s ease, transform .16s ease
    }

    .csea-results[data-show="true"] {
        display: block;
        opacity: 1;
        transform: translateY(0)
    }

    .csea-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 14px;
        padding: 14px 16px;
        text-decoration: none
    }

    .csea-item:hover,
    .csea-item[aria-selected="true"] {
        background: #f8fafc
    }

    .csea-left {
        display: flex;
        flex-direction: column
    }

    .csea-code {
        font-weight: 800;
        color: #0b1324;
        letter-spacing: .2px;
        font-size: 18px
    }

    .csea-name {
        font-size: 14px;
        color: #334155
    }

    .csea-tag {
        font-size: 12px;
        color: #1e3a8a;
        background: #eef2ff;
        border: 1px solid #e0e7ff;
        border-radius: 999px;
        padding: 4px 10px;
        white-space: nowrap
    }

    /* responsive */
    @media (max-width:640px) {
        .csea-bar {
            grid-template-columns: 22px 1fr auto auto;
            gap: 10px;
            padding: 14px
        }

        .csea-input {
            font-size: 18px
        }

        .csea-filter-btn {
            padding: 9px 12px
        }
    }
</style>

<script>
    (function () {
        /* -------- datasets -------- */
        const D9 = [{ code: "AVI1O", name: "Visual Arts" }, { code: "ADA1O", name: "Drama" }, { code: "BEM1O", name: "Building The Entrepreneurial Mindset" }, { code: "CGC1W", name: "Issues in Canadian Geography (De-Streamed)" }, { code: "ENL1W", name: "English (De-Streamed)" }, { code: "EAE1W", name: "English (French OSSD), De-Streamed" }, { code: "ENG1L", name: "English (LDCC)" }, { code: "FSF1D", name: "French (De-Streamed)" }, { code: "FSF1O", name: "Core French (Open)" }, { code: "GLS1O", name: "Learning Strategies 1: Skills for Success" }, { code: "GLE1O", name: "Learning Strategies 1: Skills for Success" }, { code: "HFN1O", name: "Food and Nutrition" }, { code: "HIF1O", name: "Exploring Family Studies" }, { code: "PPL1O", name: "Healthy Active Living Education" }, { code: "MTH1W", name: "Mathematics (De-Streamed)" }, { code: "MAT1L", name: "Mathematics (LDCC)" }, { code: "SNC1W", name: "Science (De-Streamed)" }, { code: "SNC1L", name: "Science (LDCC)" }, { code: "TIJ1O", name: "Exploring Technologies" }, { code: "TAS1O", name: "Technology and the Skilled Trades" }, { code: "NONE", name: "Not in the list" }];
        const D10 = [{ code: "AVI2O", name: "Visual Arts (G10)" }, { code: "ADA2O", name: "Drama (G10)" }, { code: "ASM2O", name: "Media Arts (G10)" }, { code: "BEP2O", name: "Launching and Leading a Business (G10)" }, { code: "CHC2D", name: "Canadian History Since WWI (Academic)" }, { code: "CHC2P", name: "Canadian History Since WWI (Applied)" }, { code: "CHV2O", name: "Civics and Citizenship" }, { code: "ENG2D", name: "English (Academic)" }, { code: "ENG2P", name: "English (Applied)" }, { code: "ENG2L", name: "English (LDCC)" }, { code: "EAE2D", name: "English (French OSSD, Academic)" }, { code: "FSF2D", name: "French (Academic)" }, { code: "FSF2O", name: "Core French (Open)" }, { code: "FSF2P", name: "Core French (Applied)" }, { code: "GLC2O", name: "Career Studies" }, { code: "HIF2O", name: "Individual and Family Living" }, { code: "HFN2O", name: "Food and Nutrition (G10)" }, { code: "ICS2O", name: "Introduction to Computer Studies" }, { code: "ICD2O", name: "Digital Technology & Innovations" }, { code: "MPM2D", name: "Principles of Mathematics (Academic)" }, { code: "MFM2P", name: "Foundations of Mathematics (Applied)" }, { code: "MAT2L", name: "Mathematics (LDCC)" }, { code: "PPL2O", name: "Healthy Active Living Education (G10)" }, { code: "SNC2D", name: "Science (Academic)" }, { code: "SNC2P", name: "Science (Applied)" }, { code: "SNC2L", name: "Science (LDCC)" }, { code: "RGJ2O", name: "Communications Technology (G10)" }, { code: "TEJ2O", name: "Computer Technology (G10)" }, { code: "TFJ2O", name: "Hospitality and Tourism (G10)" }, { code: "TDJ2O", name: "Technological Design (G10)" }, { code: "TAS2O", name: "Technology and the Skilled Trades (G10)" }, { code: "NONE", name: "Not in the list" }];
        const D11 = [{ code: "AVI3M", name: "Visual Arts (U/C)" }, { code: "AVI3O", name: "Visual Arts (Open)" }, { code: "ADA3M", name: "Drama (U/C)" }, { code: "ADA3O", name: "Drama (Open)" }, { code: "ASM3M", name: "Media Arts (U/C)" }, { code: "ASM3O", name: "Media Arts (Open)" }, { code: "BAF3M", name: "Financial Accounting Fundamentals" }, { code: "BAI3E", name: "Accounting Essentials (Workplace)" }, { code: "BDI3C", name: "Entrepreneurship: The Venture" }, { code: "BDP3O", name: "Entrepreneurship: The Enterprising Person" }, { code: "BTA3O", name: "ICT: The Digital Environment" }, { code: "BMI3C", name: "Marketing: Goods, Services, Events" }, { code: "CIE3M", name: "The Individual and the Economy" }, { code: "CGD3M", name: "Regional Geography" }, { code: "CGF3M", name: "Forces of Nature" }, { code: "CGT3O", name: "Intro to Spatial Technologies (Open)" }, { code: "CGG3O", name: "Travel & Tourism" }, { code: "CHA3U", name: "American History" }, { code: "CHW3U", name: "World History to 15th Century" }, { code: "CHT3O", name: "World History since 1900 (Open)" }, { code: "CLU3M", name: "Understanding Canadian Law" }, { code: "CPC3O", name: "Politics in Action: Making Change" }, { code: "ENG3C", name: "English (College)" }, { code: "ENG3U", name: "English (University)" }, { code: "ENG3E", name: "English (Workplace)" }, { code: "EAE3U", name: "English (French OSSD, University)" }, { code: "EPS3O", name: "Presentation and Speaking Skills" }, { code: "EMS3O", name: "Media Studies (Open)" }, { code: "FSF3U", name: "Core French (University)" }, { code: "FSF3O", name: "Core French (Open)" }, { code: "FEF3U", name: "Extended French (University)" }, { code: "FIF3U", name: "French Immersion (University)" }, { code: "FIF3O", name: "French Immersion (Open)" }, { code: "GWL3O", name: "Designing Your Future" }, { code: "HSG3M", name: "Gender Studies" }, { code: "HSE3E", name: "Equity & Social Justice (Workplace)" }, { code: "HFC3M", name: "Food and Culture" }, { code: "HPW3C", name: "Working with Infants & Young Children" }, { code: "HZB3M", name: "Philosophy: The Big Questions" }, { code: "HRT3M", name: "World Religions" }, { code: "HPC3O", name: "Raising Healthy Children" }, { code: "HSP3U", name: "Intro to Anthropology (University)" }, { code: "HSP3C", name: "Anthro/Psych/Soc (College)" }, { code: "ICS3C", name: "Intro to Computer Programming (College)" }, { code: "ICS3U", name: "Intro to Computer Science (University)" }, { code: "IDC3O", name: "Sports & Entertainment Marketing (Open)" }, { code: "MBF3C", name: "Foundations for College Mathematics" }, { code: "MCF3M", name: "Functions and Applications" }, { code: "MCR3U", name: "Functions" }, { code: "MEL3E", name: "Math for Work & Everyday Life (Workplace)" }, { code: "PPL3O", name: "Healthy Active Living Education" }, { code: "PPZ3C", name: "Health for Life" }, { code: "SBI3C", name: "Biology (College)" }, { code: "SBI3U", name: "Biology (University)" }, { code: "SCH3U", name: "Chemistry (University)" }, { code: "SPH3U", name: "Physics (University)" }, { code: "SVN3M", name: "Environmental Science (U/C)" }, { code: "SVN3E", name: "Environmental Science (Workplace)" }, { code: "TEI3M", name: "Computer Eng. Tech: Interfacing (U/C)" }, { code: "TEJ3M", name: "Computer Engineering Technology (U/C)" }, { code: "TEL3M", name: "Computer Eng. Tech: Electronics (U/C)" }, { code: "TEN3M", name: "Computer Eng. Tech: Networking (U/C)" }, { code: "TET3E", name: "Computer Technology: IT Support" }, { code: "TEW3E", name: "Computer Technology: Network Support" }, { code: "TGJ3M", name: "Communications Technology (U/C)" }, { code: "TFE3E", name: "Hospitality & Tourism: Event Planning (W)" }, { code: "TFJ3E", name: "Hospitality & Tourism (Workplace)" }, { code: "TFJC", name: "Hospitality & Tourism (College)" }, { code: "TDJ3M", name: "Technological Design (U/C)" }, { code: "TGJ3O", name: "Communications Tech: Broadcast/Print" }, { code: "TDJ3O", name: "Technological Design and the Environment" }, { code: "TGI3M", name: "Interactive New Media & Animation (U/C)" }, { code: "TGP3M", name: "Photography & Digital Imaging (U/C)" }, { code: "TPD3M", name: "Health Care: Dental Services (U/C)" }, { code: "TPL3M", name: "Health Care: Laboratory Services (U/C)" }, { code: "TPM3M", name: "Health Care: Nursing/Medical Services (U/C)" }, { code: "TPP3M", name: "Health Services: Pharmacy (U/C)" }, { code: "TPT3M", name: "Health Care: Therapy Services (U/C)" }, { code: "TPJ3C", name: "Health Care (College)" }, { code: "TPJ3M", name: "Health Care (U/C)" }, { code: "NONE", name: "Not in the list" }];
        const D12 = [{ code: "ADA4E", name: "Drama (Workplace)" }, { code: "ADA4M", name: "Drama (U/C)" }, { code: "AEA4O", name: "Exploring & Creating in the Arts" }, { code: "ASM4M", name: "Media Arts (U/C)" }, { code: "ASM4E", name: "Media Arts (Workplace)" }, { code: "AVI4M", name: "Visual Arts (U/C)" }, { code: "BAT4M", name: "Financial Accounting Principles" }, { code: "BDV4C", name: "Entrepreneurship: Venture Planning (C)" }, { code: "BTX4C", name: "ICT: Multimedia Solutions (C)" }, { code: "BBB4M", name: "International Business Fundamentals" }, { code: "BOH4M", name: "Business Leadership" }, { code: "CIA4U", name: "Analysing Current Economic Issues" }, { code: "CGW4U", name: "World Issues (University)" }, { code: "CGW4C", name: "World Issues (College)" }, { code: "CGR4M", name: "Environment & Resource Management" }, { code: "CGO4M", name: "Spatial Technologies in Action" }, { code: "CGU4M", name: "World Geography: Urban Patterns" }, { code: "CHY4U", name: "World History since 15th Century (U)" }, { code: "CHY4C", name: "World History since 15th Century (C)" }, { code: "CHI4U", name: "Canada: History, Identity & Culture" }, { code: "CLN4U", name: "Canadian & International Law (U)" }, { code: "CLN4C", name: "Legal Studies (College)" }, { code: "CPW4U", name: "Canadian & International Politics" }, { code: "ENG4U", name: "English (University)" }, { code: "ENG4C", name: "English (College)" }, { code: "ENG4E", name: "English (Workplace)" }, { code: "EAE4U", name: "English (French OSSD, University)" }, { code: "EWC4U", name: "The Writer’s Craft (University)" }, { code: "EWC4C", name: "The Writer’s Craft (College)" }, { code: "FSF4U", name: "Core French (University)" }, { code: "FSF4O", name: "Core French (Open)" }, { code: "HSE4M", name: "Equity & Social Justice" }, { code: "HSC4M", name: "World Cultures" }, { code: "HFA4U", name: "Nutrition & Health (University)" }, { code: "HFA4C", name: "Nutrition & Health (College)" }, { code: "HHS4U", name: "Families in Canada (University)" }, { code: "HHS4C", name: "Families in Canada (College)" }, { code: "HHG4M", name: "Human Development Through the Life Span" }, { code: "HIP4O", name: "Personal Life Management" }, { code: "HPD4C", name: "Working with School-Age Children & Adolescents" }, { code: "HSB4U", name: "Challenge & Change in Society" }, { code: "HZT4U", name: "Philosophy: Questions & Theories" }, { code: "ICS4U", name: "Computer Science (University)" }, { code: "ICS4C", name: "Computer Programming (College)" }, { code: "IDC4U", name: "Sports & Entertainment Marketing (U)" }, { code: "IDC4O", name: "Sports & Entertainment Marketing (Open)" }, { code: "MHF4U", name: "Advanced Functions" }, { code: "MCV4U", name: "Calculus and Vectors" }, { code: "MDM4U", name: "Mathematics of Data Management" }, { code: "MCT4C", name: "Mathematics for College Technology" }, { code: "MAP4C", name: "Foundations for College Mathematics" }, { code: "MEL4E", name: "Math for Work & Everyday Life (Workplace)" }, { code: "OLC4O", name: "Ontario Secondary School Literacy Course" }, { code: "PPL4O", name: "Healthy Active Living Education" }, { code: "PLF4M", name: "Recreation & Healthy Active Living Leadership" }, { code: "PSK4U", name: "Introductory Kinesiology" }, { code: "SBI4U", name: "Biology (University)" }, { code: "SCH4C", name: "Chemistry (College)" }, { code: "SCH4U", name: "Chemistry (University)" }, { code: "SPH4U", name: "Physics (University)" }, { code: "SES4U", name: "Earth and Space Science" }, { code: "SNC4M", name: "Science (U/C)" }, { code: "SNC4E", name: "Science (Workplace)" }, { code: "TGJ4M", name: "Communications Technology (U/C)" }, { code: "TGJ4O", name: "Communications Tech: Digital Imagery & Web" }, { code: "TEJ4M", name: "Computer Engineering Technology (U/C)" }, { code: "TFJ4E", name: "Hospitality & Tourism (Workplace)" }, { code: "TFJ4C", name: "Hospitality & Tourism (College)" }, { code: "TDJ4M", name: "Technological Design (U/C)" }, { code: "TDJ4O", name: "Technological Design in the 21st Century" }, { code: "TEI4M", name: "Computer Eng. Tech: Interfacing (U/C)" }, { code: "TEN4M", name: "Computer Eng. Tech: Networking" }, { code: "TET4E", name: "Computer Technology: IT Support" }, { code: "TEW4E", name: "Computer Technology: Network Support" }, { code: "TGI4M", name: "Interactive New Media & Animation" }, { code: "TGP4M", name: "Photography & Digital Imaging" }, { code: "TOC4C", name: "Child Development" }, { code: "TOG4C", name: "Gerontology" }, { code: "TPD4M", name: "Health Care: Dental Services" }, { code: "TPL4M", name: "Health Care: Laboratory Services" }, { code: "TPM4M", name: "Health Care: Nursing/Medical Services" }, { code: "TPP4M", name: "Health Services: Pharmacy" }, { code: "TPT4M", name: "Health Care: Therapy Services" }, { code: "TPJ4C", name: "Health Care (College)" }, { code: "TPJ4E", name: "Health Care (Workplace)" }, { code: "TPJ4M", name: "Health Care (U/C)" }, { code: "NONE", name: "Not in the list" }];
        const DESL = [{ code: "NONE", name: "Not in the list" }, { code: "ESLAO", name: "ESL Level 1" }, { code: "ESLBO", name: "ESL Level 2" }, { code: "ESLCO", name: "ESL Level 3" }, { code: "ESLDO", name: "ESL Level 4" }, { code: "ESLEO", name: "ESL Level 5" }, { code: "ELDAO", name: "ELD Level 1" }, { code: "ELDBO", name: "ELD Level 2" }, { code: "ELDCO", name: "ELD Level 3" }, { code: "ELDDO", name: "ELD Level 4" }, { code: "ELDEO", name: "ELD Level 5" }];

        const GRADE_MAP = { "Grade 9": D9, "Grade 10": D10, "Grade 11": D11, "Grade 12": D12, "ESL/ELD Courses": DESL };
        const ALL = [...D9, ...D10, ...D11, ...D12, ...DESL].filter(x => x.code !== "NONE");

        const BASE = "https://canstemeducation.com/product/";
        const toURL = code => BASE + String(code || "").toLowerCase() + "/";

        const $ = id => document.getElementById(id);
        const input = $("csea-input"), list = $("csea-results"), bar = document.querySelector(".csea-bar"),
            clearBtn = $("csea-clear"), filter = document.querySelector(".csea-filter"),
            filterBtn = $("csea-filter-btn"), filterMenu = $("csea-filter-menu"), filterLabel = $("csea-filter-label");

        let grade = "ALL", idx = -1, results = [];
        const MIN = 1;

        const listFor = g => g === "ALL" ? ALL : (GRADE_MAP[g] || []).filter(x => x.code !== "NONE");
        const whichGrade = code => {
            if (D9.some(x => x.code === code)) return "Grade 9";
            if (D10.some(x => x.code === code)) return "Grade 10";
            if (D11.some(x => x.code === code)) return "Grade 11";
            if (D12.some(x => x.code === code)) return "Grade 12";
            if (DESL.some(x => x.code === code)) return "ESL & ELD";
            return "";
        };

        const expanded = on => { bar.setAttribute("aria-expanded", on ? "true" : "false"); list.dataset.show = on ? "true" : "false"; if (!on) { list.style.display = "" } };
        function clearList() { list.innerHTML = ""; idx = -1; }

        function search(q) {
            const t = q.trim().toUpperCase(); if (t.length < MIN) return [];
            const pool = listFor(grade); const out = [];
            for (const it of pool) {
                const C = it.code.toUpperCase(), N = it.name.toUpperCase();
                let s = null; if (C.startsWith(t)) s = 0; else if (C.includes(t)) s = 1; else if (N.includes(t)) s = 2;
                if (s !== null) out.push({ ...it, score: s });
            }
            return out.sort((a, b) => a.score - b.score || a.code.localeCompare(b.code)).slice(0, 20);
        }

        function render() {
            results = search(input.value); clearList();
            clearBtn.style.display = input.value ? "inline" : "none";
            if (!results.length) { expanded(false); return; }
            results.forEach((it, i) => {
                const a = document.createElement("a");
                a.href = toURL(it.code);
                a.className = "csea-item"; a.id = "csea-opt-" + i; a.role = "option"; a.setAttribute("aria-selected", "false");
                a.innerHTML = `<div class="csea-left">
                      <span class="csea-code">${it.code}</span>
                      <span class="csea-name">${it.name}</span>
                    </div>
                    <span class="csea-tag">${grade === "ALL" ? whichGrade(it.code) : grade}</span>`;
                list.appendChild(a);
            });
            list.style.display = "block"; // ensure for transition
            requestAnimationFrame(() => expanded(true));
        }

        function highlight(i) {
            const items = [...list.querySelectorAll(".csea-item")];
            items.forEach(el => el.setAttribute("aria-selected", "false"));
            if (i >= 0 && items[i]) { items[i].setAttribute("aria-selected", "true"); items[i].scrollIntoView({ block: "nearest" }); }
            idx = i;
        }

        // input events
        input.addEventListener("input", render);
        input.addEventListener("focus", render);
        input.addEventListener("blur", () => setTimeout(() => expanded(false), 120));
        input.addEventListener("keydown", e => {
            const n = results.length;
            if (e.key === "ArrowDown" && n) { e.preventDefault(); highlight(Math.min(idx + 1, n - 1)); }
            else if (e.key === "ArrowUp" && n) { e.preventDefault(); highlight(Math.max(idx - 1, 0)); }
            else if (e.key === "Enter") {
                e.preventDefault();
                const items = [...list.querySelectorAll(".csea-item")];
                if (n && idx >= 0) window.location.href = items[idx].href;
                else if (n) window.location.href = items[0].href;
                else if (input.value.trim()) window.location.href = toURL(input.value.trim().toUpperCase());
            } else if (e.key === "Escape") { expanded(false); }
        });

        clearBtn.addEventListener("click", () => { input.value = ""; clearBtn.style.display = "none"; clearList(); expanded(false); input.focus(); });

        // custom filter menu
        function openMenu(on) {
            filter.dataset.open = on ? "true" : "false";
            filterBtn.setAttribute("aria-expanded", on ? "true" : "false");
        }
        filterBtn.addEventListener("click", e => { e.stopPropagation(); openMenu(filter.dataset.open !== "true"); });
        document.addEventListener("click", e => {
            if (!filter.contains(e.target)) openMenu(false);
        });
        document.addEventListener("keydown", e => {
            if (e.key === "Escape") openMenu(false);
        });
        filterMenu.querySelectorAll(".csea-menu-item").forEach(btn => {
            btn.addEventListener("click", () => {
                grade = btn.dataset.grade; filterLabel.textContent = (grade === "ALL" ? "All" : btn.textContent);
                openMenu(false); render(); input.focus();
            });
        });

        // start collapsed
        expanded(false);
    })();
</script>
<!-- ================== /CanSTEM Elegant Search - RIGHT FILTER ================== -->